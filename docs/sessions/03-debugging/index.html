<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Session 03: Debugging in Unikraft | Unikraft Summer of Code 2021</title><meta property="og:title" content="Session 03: Debugging in Unikraft"><meta property="og:description" content="Because unikernels aim to be a more efficient method of virtualization, this can sometimes cause problems. This session aims to familiarize you to solve any problem encountered during the development using GDB and Tracepoints.
Reminders At this stage, you should be familiar with the steps of configuring, building and running any application within Unikraft and know the main parts of the architecture. Below you can see a list of the commands you have used so far."><meta property="og:type" content="article"><meta property="og:url" content="/docs/sessions/03-debugging/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2021-08-31T20:44:43+02:00"><meta property="og:site_name" content="Unikraft Summer of Code 2021"><meta itemprop=name content="Session 03: Debugging in Unikraft"><meta itemprop=description content="Because unikernels aim to be a more efficient method of virtualization, this can sometimes cause problems. This session aims to familiarize you to solve any problem encountered during the development using GDB and Tracepoints.
Reminders At this stage, you should be familiar with the steps of configuring, building and running any application within Unikraft and know the main parts of the architecture. Below you can see a list of the commands you have used so far."><meta itemprop=dateModified content="2021-08-31T20:44:43+02:00"><meta itemprop=wordCount content="2933"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Session 03: Debugging in Unikraft"><meta name=twitter:description content="Because unikernels aim to be a more efficient method of virtualization, this can sometimes cause problems. This session aims to familiarize you to solve any problem encountered during the development using GDB and Tracepoints.
Reminders At this stage, you should be familiar with the steps of configuring, building and running any application within Unikraft and know the main parts of the architecture. Below you can see a list of the commands you have used so far."><link rel=preload href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css as=style><link href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Unikraft Summer of Code 2021</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Workshop</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center d-lg-none"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Workshop</a></li><ul><li class="collapse show" id=docs><a class="td-sidebar-link td-sidebar-link__page" id=m-docssessionsschedule href=/docs/sessions/schedule/>Schedule</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsoverviewpeople href=/docs/overview/people/>People</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions01-baby-steps href=/docs/sessions/01-baby-steps/>01. Baby Steps</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions02-behind-scenes href=/docs/sessions/02-behind-scenes/>02. Behind the Scenes</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-docssessions03-debugging href=/docs/sessions/03-debugging/>03. Debugging in Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions04-complex-applications href=/docs/sessions/04-complex-applications/>04. Complex Applications</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions05-contributing-to-unikraft href=/docs/sessions/05-contributing-to-unikraft/>05. Contributing to Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions06-testing-unikraft href=/docs/sessions/06-testing-unikraft/>06. Testing Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions07-syscall-shim href=/docs/sessions/07-syscall-shim/>07. Syscall Shim</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions08-basic-app-porting href=/docs/sessions/08-basic-app-porting/>08. Basic App Porting</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions09-advanced-app-porting href=/docs/sessions/09-advanced-app-porting/>09. Advanced App Porting</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions10-high-performance href=/docs/sessions/10-high-performance/>10. High Performance</a></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/unikraft/summer-of-code-2021/edit/master/content/en/docs/sessions/03-debugging/index.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/unikraft/summer-of-code-2021/new/master/content/en/docs/sessions/03-debugging/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/unikraft/summer-of-code-2021/issues/new?title=Session%2003:%20Debugging%20in%20Unikraft" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/unikraft/unikraft/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
<a id=print href=/docs/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><nav id=TableOfContents><ul><li><a href=#reminders>Reminders</a></li><li><a href=#support-files>Support Files</a></li><li><a href=#debugging>Debugging</a><ul><li><a href=#using-gdb>Using GDB</a></li></ul></li><li><a href=#tracepoints>Tracepoints</a><ul><li><a href=#dependencies>Dependencies</a></li><li><a href=#enabling-tracing>Enabling Tracing</a></li><li><a href=#creating-tracepoints>Creating Tracepoints</a></li><li><a href=#reading-trace-data>Reading Trace Data</a></li></ul></li><li><a href=#summary>Summary</a></li><li><a href=#practical-work>Practical Work</a><ul><li><a href=#support-files-1>Support Files</a></li><li><a href=#01-tutorial-use-gdb-in-unikraft>01. Tutorial. Use GDB in Unikraft</a></li><li><a href=#02-mystery-find-the-secret-using-gdb>02. Mystery: Find the secret using GDB</a></li><li><a href=#03-bug-or-feature>03. Bug or feature?</a></li><li><a href=#04-tutorial-use-tracepoints>04. Tutorial. Use Tracepoints.</a></li><li><a href=#05-can-you-trace-your-own-program>05. Can you trace your own program?</a></li><li><a href=#06-nginx-with-or-without-main-thats-the-question>06. Nginx with or without main? That&rsquo;s the question.</a></li><li><a href=#07-bonus-bad-elf-in-town>07. Bonus. Bad ELF in Town</a></li><li><a href=#08-give-us-feedback>08. Give Us Feedback</a></li></ul></li><li><a href=#further-reading>Further Reading</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Workshop</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/sessions/03-debugging/>03. Debugging in Unikraft</a></li></ol></nav><div class=td-content><h1>Session 03: Debugging in Unikraft</h1><p>Because unikernels aim to be a more efficient method of virtualization, this can sometimes cause problems.
This session aims to familiarize you to solve any problem encountered during the development using <strong>GDB</strong> and <strong>Tracepoints</strong>.</p><h2 id=reminders>Reminders</h2><p>At this stage, you should be familiar with the steps of configuring, building and running any application within Unikraft and know the main parts of the architecture.
Below you can see a list of the commands you have used so far.</p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>kraft list</code></td><td>Get a list of all components that are available for use with kraft</td></tr><tr><td><code>kraft up -t &lt;appname> &lt;your_appname></code></td><td>Download, configure and build existing components into unikernel images</td></tr><tr><td><code>kraft run</code></td><td>Run resulting unikernel image</td></tr><tr><td><code>kraft init -t &lt;appname></code></td><td>Initialize the application</td></tr><tr><td><code>kraft configure</code></td><td>Configure platform and architecture (interactive)</td></tr><tr><td><code>kraft configure -p &lt;plat> -m &lt;arch></code></td><td>Configure platform and architecture (non-interactive)</td></tr><tr><td><code>kraft build</code></td><td>Build the application</td></tr><tr><td><code>kraft clean</code></td><td>Clean the application</td></tr><tr><td><code>make menuconfig</code></td><td>Configure application through the main menu</td></tr></tbody></table><h2 id=support-files>Support Files</h2><p>Session support files are available <a href=https://github.com/unikraft/summer-of-code-2021>in the repository</a>.
If you already cloned the repository, update it and enter the session directory:</p><pre><code>$ cd path/to/repository/clone

$ git pull --rebase

$ cd content/en/docs/sessions/03-debugging/

$ ls
demo/  images/  index.md  sol/  work/
</code></pre><p>If you haven&rsquo;t cloned the repository yet, clone it and enter the session directory:</p><pre><code>$ git clone https://github.com/unikraft/summer-of-code-2021

$ cd summer-of-code-2021/content/en/docs/sessions/03-debugging/

$ ls
demo/  images/  index.md  sol/  work/
</code></pre><h2 id=debugging>Debugging</h2><p>Contrary to popular belief, debugging a unikernel is in fact simpler than debugging a standard operating system.
Since the application and OS are linked into a single binary, debuggers can be used on the running unikernel to debug both application and OS code at the same time.
A couple of hints that should help starting:</p><ol><li>In the configuration menu (presented with <code>make menuconfig</code>), under <code>Build Options</code> make sure that <code>Drop unused functions and data</code> is <strong>unselected</strong>.
This prevents Unikraft from removing unused symbols from the final image and, if enabled, might hide missing dependencies during development.</li><li>Use <code>make V=1</code> to see verbose output for all of the commands being executed during the build.
If the compilation for a particular file is breaking and you would like to understand why (e.g., perhaps the include paths are wrong), you can debug things by adding the <code>-E</code> flag to the command, removing the <code>-o [objname]</code>, and redirecting the output to a file which you can then inspect.</li><li>Check out the targets under <code>Miscellaneous</code> when typing <code>make help</code>, these may come in handy.
For instance, <code>make print-vars</code> enables inspecting at the value of a particular variable in <code>Makefile.uk</code>.</li><li>Use the individual <code>make clean-[libname]</code> targets to ensure that you&rsquo;re cleaning only the part of Unikraft you&rsquo;re working on and not all the libraries that it may depend on.
This will speed up the build and thus the development process.</li><li>Use the Linux user space platform target (<code>linuxu</code>) for quicker and easier development and debugging.</li></ol><h3 id=using-gdb>Using GDB</h3><p>The build system always creates two image files for each selected platform:</p><ul><li>one that includes debugging information and symbols (<code>.dbg</code> file extension)</li><li>one that does not</li></ul><p>Before using GDB, go to the configuration menu under <code>Build Options</code> and select a <code>Debug information level</code> that is bigger than 0.
We recommend 3, the highest level.</p><p><img src=./images/debug_information_level.png alt="debug information level"></p><p>Once set, save the configuration and build your images.</p><h4 id=linuxu>Linuxu</h4><hr><p>For the Linux user space target (<code>linuxu</code>) simply point GDB to the resulting debug image, for example:</p><pre><code>$ gdb build/app-helloworld_linuxu-x86_64.dbg
</code></pre><h4 id=kvm>KVM</h4><hr><p>For KVM, you can start the guest with the kernel image that includes debugging information, or the one that does not.
We recommend creating the guest in a paused state (the <code>-S</code> option):</p><pre><code>$ qemu-system-x86_64 -s -S -cpu host -enable-kvm -m 128 -nodefaults -no-acpi -display none -serial stdio -device isa-debug-exit -kernel build/app-helloworld_kvm-x86_64.dbg -append verbose
</code></pre><p>Note that the <code>-s</code> parameter is shorthand for <code>-gdb tcp::1234</code>.
To avoid this long <code>qemu-system-x86</code> command with a lot of arguments, we can use <code>qemu-guest</code>.</p><pre><code>$ qemu-guest -P -g 1234 -k build/app-helloworld_kvm-x86_64.dbg
</code></pre><p>Now connect GDB by using the debug image with:</p><pre><code>$ gdb --eval-command=&quot;target remote :1234&quot; build/app-helloworld_kvm-x86_64.dbg
</code></pre><p>Unless you&rsquo;re debugging early boot code (until <code>_libkvmplat_start32</code>), you’ll need to set a hardware break point:
Hardware breakpoints have the same effect as the common software breakpoints you are used to, but they are different in the implementation.
As the name suggests, hardware breakpoints are based on direct hardware support.
This may limit the number of breakpoints you can set, but makes them especially useful when debugging kernel code.</p><pre><code>hbreak [location]
continue
</code></pre><p>We’ll now need to set the right CPU architecture:</p><pre><code>disconnect
set arch i386:x86-64:intel
</code></pre><p>And reconnect:</p><pre><code>tar remote localhost:1234
</code></pre><p>You can now run <code>continue</code> and debug as you would normally.</p><h4 id=xen>Xen</h4><hr><div class="alert alert-primary" role=alert><h4 class=alert-heading>Running Unikraft in Xen</h4><p>For Xen you first need to create a VM configuration (save it under <code>helloworld.cfg</code>):</p><pre><code>name          = 'helloworld'
vcpus         = '1'
memory        = '4'
kernel        = 'build/app-helloworld_xen-x86_64.dbg'
</code></pre><p>Start the virtual machine with:</p><p><code>$ xl create -c helloworld.cfg</code></p></div><p>For Xen the process is slightly more complicated and depends on Xen&rsquo;s <code>gdbsx</code> tool.
First you&rsquo;ll need to make sure you have the tool on your system.
Here are sample instructions to do that:</p><pre><code>[get Xen sources]
$ ./configure
$ cd tools/debugger/gdbsx/ &amp;&amp; make
</code></pre><p>The <code>gdbsx</code> tool will then be under tools/debugger.
For the actual debugging, you first need to create the guest (we recommend paused state: <code>xl create -p</code>), note its domain ID (<code>xl list</code>) and execute the debugger backend:</p><pre><code>$ gdbsx -a [DOMAIN ID] 64 [PORT]
</code></pre><p>You can then connect GDB within a separate console and you&rsquo;re ready to debug:</p><pre><code>$ gdb --eval-command=&quot;target remote :[PORT]&quot; build/helloworld_xen-x86_64.dbg
</code></pre><p>You should be also able to use the debugging file (<code>build/app-helloworld_xen-x86_64.dbg</code>) for GDB instead passing the kernel image.</p><h2 id=tracepoints>Tracepoints</h2><p>Because Unikraft needs a tracing and performance measurement system, one method to do this is using Unikrat&rsquo;s tracepoint system.
A tracepoint provides a hook to call a function that you can provide at runtime.
You can put tracepoints at important locations in the code.
They are lightweight hooks that can pass an arbitrary number of parameters, which prototypes are described in a tracepoint declaration placed in a header file.</p><h3 id=dependencies>Dependencies</h3><p>We provide some tools to read and export trace data that were collected with Unikraft&rsquo;s tracepoint system.
The tools depend on Python3, as well as the click and tabulate modules.
You can install them by running (Debian/Ubuntu):</p><pre><code>sudo apt-get install python3 python3-click python3-tabulate
</code></pre><h3 id=enabling-tracing>Enabling Tracing</h3><p>Tracepoints are provided by <code>lib/ukdebug</code>.
To enable Unikraft to collect trace data, enable the option <code>CONFIG_LIBUKDEBUG_TRACEPOINTS</code> in your configuration (via <code>make menuconfig</code> under <code>Library Configuration -> ukdebug -> Enable tracepoints</code>).</p><p><img src=./images/enable_tracepoints.png alt="enable tracepoints"></p><p>The configuration option <code>CONFIG_LIBUKDEBUG_ALL_TRACEPOINTS</code> activates <strong>all</strong> existing tracepoints.
Because tracepoints may noticeably affect performance, you can alternatively enable tracepoints only for compilation units that you are interested in.</p><p>This can be done with the <code>Makefile.uk</code> of each library.</p><pre><code># Enable tracepoints for a whole library
LIBNAME_CFLAGS-y += -DUK_DEBUG_TRACE
LIBNAME_CXXFLAGS-y += -DUK_DEBUG_TRACE

# Alternatively, enable tracepoints of source files you are interested in
LIBNAME_FILENAME1_FLAGS-y += -DUK_DEBUG_TRACE
LIBNAME_FILENAME2_FLAGS-y += -DUK_DEBUG_TRACE
</code></pre><p>This can also be done by defining <code>UK_DEBUG_TRACE</code> in the head of your source files.
Please make sure that <code>UK_DEBUG_TRACE</code> is defined before <code>&lt;uk/trace.h></code> is included:</p><pre><code>#ifndef UK_DEBUG_TRACE
#define UK_DEBUG_TRACE
#endif

#include &lt;uk/trace.h&gt;
</code></pre><p>As soon as tracing is enabled, Unikraft will store samples of each enabled tracepoint into an internal trace buffer.
Currently this is not a circular buffer.
This means that as soon as it is full, Unikraft will stop collecting further samples.</p><h3 id=creating-tracepoints>Creating Tracepoints</h3><p>Instrumenting your code with tracepoints is done by two steps.
First, you define and register a tracepoint handler with the <code>UK_TRACEPOINT()</code> macro.
Second, you place calls to the generated handler at those places in your code where your want to trace an event:</p><pre><code>#include &lt;uk/trace.h&gt;

UK_TRACEPOINT(trace_vfs_open, &quot;\&quot;%s\&quot; 0x%x 0%0o&quot;, const char*, int, mode_t);

int open(const char *pathname, int flags, ...)
{
      trace_vfs_open(pathname, flags, mode);

      /* lots of cool stuff */

      return 0;
}
</code></pre><p><code>UK_TRACEPOINT(trace_name, fmt, type1, type2, ... typeN)</code> generates the handler <code>trace_name()</code> (static function).
It will accept up to 7 parameters of type <code>type1</code>, <code>type2</code>, etc.
The given format string <code>fmt</code> is a printf-style format which will be used to create meaningful messages based on the collected trace parameters.
This format string is only kept in the debug image and is used by the tools to read and parse the trace data.
Unikraft&rsquo;s trace buffer stores for each sample a timestamp, the name of the tracepoint, and the given parameters.</p><h3 id=reading-trace-data>Reading Trace Data</h3><p>Unikraft is storing trace data to an internal buffer that resides in the guest&rsquo;s main memory.
You can use GDB to read and export it.
For this purpose, you will need to load the <code>uk-gdb.py</code> helper script into your GDB session.
It adds additional commands that allow you to list and store the trace data.
We recommend to automatically load the script to GDB.
For this purpose, add the following line to your <code>~/.gdbinit</code>:</p><pre><code>source /path/to/your/build/uk-gdb.py
</code></pre><p>In order to collect the data, open GDB with the debug image and connect to your Unikraft instance as described in Section <a href=#using-gdb>Using GDB</a>:</p><pre><code>$ gdb build/app-helloworld_linuxu-x86_64.dbg
</code></pre><p>The <code>.dbg</code> image is required because it contains offline data needed for parsing the trace buffer.</p><p>As soon as you let run your guest, samples should be stored in Unikraft&rsquo;s trace buffer.
You can print them by issuing the GDB command <code>uk trace</code>:</p><pre><code>(gdb) uk trace
</code></pre><p>Alternatively, you can save all trace data to disk with <code>uk trace save &lt;filename></code>:</p><pre><code>(gdb) uk trace save traces.dat
</code></pre><p>It may make sense to connect with GDB after the guest execution has been finished (and the trace buffer got filled).
For this purpose, make sure that your hypervisor is not destroying the instance after guest shut down (on QEMU add <code>--no-shutdown</code> and <code>--no-reboot</code> parameters).</p><p>If you are seeing the error message <code>Error getting the trace buffer. Is tracing enabled?</code>, you probably did not enable tracing or Unikraft&rsquo;s trace buffer is empty.
This can happen when no tracepoint was ever called.</p><p>Any saved trace file can be later processed with the <code>trace.py</code> script. In our example:</p><pre><code>$ support/scripts/uk_trace/trace.py list traces.dat
</code></pre><h2 id=summary>Summary</h2><h2 id=practical-work>Practical Work</h2><h3 id=support-files-1>Support Files</h3><p>Session support files are available <a href=https://github.com/unikraft/summer-of-code-2021>in the repository</a>.
If you already cloned the repository, update it and enter the session directory:</p><pre><code>$ cd path/to/repository/clone

$ git pull --rebase

$ cd content/en/docs/sessions/03-debugging/

$ ls
demo/  images/  index.md  sol/  work/
</code></pre><p>If you haven&rsquo;t cloned the repository yet, clone it and enter the session directory:</p><pre><code>$ git clone https://github.com/unikraft/summer-of-code-2021

$ cd summer-of-code-2021/content/en/docs/sessions/03-debugging/

$ ls
demo/  images/  index.md  sol/  work/
</code></pre><h3 id=01-tutorial-use-gdb-in-unikraft>01. Tutorial. Use GDB in Unikraft</h3><p>For this tutorial, we will just start the <code>app-helloworld</code> application and inspect it with the help of GDB.</p><p>First make sure you have the following file structure in your working directory:</p><pre><code>workdir
|_______apps
|	|_______helloworld
|_______libs
|_______unikraft
</code></pre><h4 id=linuxu-1>Linuxu</h4><p>For the image for the <strong>linuxu</strong> platform we can use GDB directly with the binary already created.</p><pre><code>$ gdb build/app-helloworld_linuxu-x86_64.dbg
</code></pre><h4 id=kvm-1>KVM</h4><p>To avoid using a command with a lot of parameters that you noticed above in the <strong>KVM</strong> section, we can use <code>qemu-guest</code>.</p><pre><code>$ qemu-guest -P -g 1234 -k build/app-helloworld_kvm-x86_64.dbg
</code></pre><p>Open another terminal to connect to GDB by using the debug image with:</p><pre><code>$ gdb --eval-command=&quot;target remote :1234&quot; build/app-helloworld_kvm-x86_64.dbg
</code></pre><p>First you can set the right CPU architecture and then reconnect:</p><pre><code>disconnect
set arch i386:x86-64:intel
tar remote localhost:1234
</code></pre><p>Then you can put a hardware break point at main function and run <code>continue</code>:</p><pre><code>hbreak main
continue
</code></pre><p>All steps described above can be done using the script <code>kvm_gdb_debug</code> located in the <code>work/01-tutorial-gdb/</code> folder.
All you need to do is to provide the path to kernel image.</p><pre><code>kvm_gdb_debug build/app-helloworld_kvm-x86_64.dbg
</code></pre><h3 id=02-mystery-find-the-secret-using-gdb>02. Mystery: Find the secret using GDB</h3><p>Before starting the task let&rsquo;s get familiar with some GDB commands.</p><p><code>ni</code> - go to the next instruction, but skip function calls</p><p><code>si</code> - go to the next instruction, but enters function calls</p><p><code>c</code> - continue execution to the next breakpoint</p><p><code>p expr</code> - display the value of an expression</p><p><code>x addr</code> - get the value at the indicated address (similar to <code>p *addr</code>)</p><p><code>whatis arg</code> - print the data type of <code>arg</code></p><p>GDB provides convenience variables that you can use within GDB to hold on to a value and refer to it later.
For example:</p><pre><code>set $foo = *object_ptr
</code></pre><p>Note that you can also cast variables in GDB similar to C:</p><pre><code>set $var = (int *) ptr
</code></pre><p>If you want to dereference a pointer and actually see the value, you can use the following command:</p><pre><code>p *addr
</code></pre><p>You can find more GDB commands <a href=https://users.ece.utexas.edu/~adnan/gdb-refcard.pdf>here</a>
Also, if you are unfamiliar with X86_64 calling convention you can read more about it <a href=https://en.wikipedia.org/wiki/X86_calling_conventions>here</a>.</p><p>Now, let&rsquo;s get back to the task.
Download the <code>mystery_kvm-x86_64</code> file from <a href="https://drive.google.com/drive/folders/1K74TYViRxGtyRwDepJ3W_JNOZWdO2LXT?usp=sharing">here</a>.
Copy the <code>mystery_kvm-x86_64</code> file to the <code>work/02-mystery/</code> directory.
Navigate to <code>work/02-mystery/</code> directory.
Use the 2 scripts in the directory (<code>debug.sh</code> and <code>connect.sh</code>) to start the <code>mystery_kvm-x86_64.dbg</code> executable using GDB.
Do you think you can find out the <strong>secret</strong>?</p><p><strong>HINT</strong> Use the <code>nm</code> utility on the binary as a starting point.</p><h3 id=03-bug-or-feature>03. Bug or feature?</h3><p>There are two kernel images located in the <code>work/03-app-bug/</code> folder.
One of them is build for <strong>Linuxu</strong>, the other for <strong>KVM</strong>.</p><p>First try to inspect what it&rsquo;s wrong with <strong>Linuxu</strong> image.
You will notice that if you run the program you will get a segmentation fault.
Why does this happen?</p><p>After you figure out what it&rsquo;s happening with <strong>Linuxu</strong> image have a look also at the <strong>KVM</strong> one.
It was built from the code source, but when you will try to run it, you will not get a segmentation fault.
Is this a bug or a feature?</p><h3 id=04-tutorial-use-tracepoints>04. Tutorial. Use Tracepoints.</h3><p>We will start from the <code>app-helloworld</code> application and we will put two tracepoints.
One at the beginning of the program (after the main) and one at the end of it and these tracepoints should print <code>argc</code>.</p><p>First we need to define <code>UK_DEBUG_TRACE</code> and to include <code>uk/trace.h</code>.</p><pre><code>#ifndef UK_DEBUG_TRACE
#define UK_DEBUG_TRACE
#endif

#include &lt;uk/trace.h&gt;
</code></pre><p>After that we have to define those tracepoints that we want to use.
In our case it should be something similar with:</p><pre><code>UK_TRACEPOINT(start_trace, &quot;%d&quot;, int);
UK_TRACEPOINT(stop_trace, &quot;%d&quot;, int);
</code></pre><p>Now we can invoke them inside the main.</p><pre><code>int main(int argc, char *argv[])
{
    start_trace(argc);
    start_status();

    printf(&quot;Hello world!\n&quot;);

    stop_trace(argc);
    stop_status();

    return 0;
}

</code></pre><p>We also added two simple functions for a better view of tracepoints in GDB.</p><pre><code>void start_status(){
    printf(&quot;Start tracing\n&quot;);
}

void stop_status(){
    printf(&quot;Stop tracing\n&quot;);
}
</code></pre><p>You can check the source code for this tutorial in <code>work/04-tutorial-tracepoints.</code>
Now we can build the application, but we need to make sure that we have checked the <code>CONFIG_LIBUKDEBUG_TRACEPOINTS</code> option in the configuration.(<code>Library Configuration -> ukdebug -> Enable tracepoints</code>)</p><p>Now we will have to start the application in paused state.</p><pre><code>qemu-guest -P -g 1234 -k build/app-helloworld-tracepoints_kvm-x86_64.dbg
</code></pre><p>In another terminal we will start the GDB:</p><pre><code>gdb --eval-command=&quot;target remote :1234&quot; build/app-helloworld-tracepoints_kvm-x86_64.dbg
</code></pre><p>Put a hardware break to main and continue until there.</p><pre><code>(gdb) hbreak main
(gdb) continue
</code></pre><p>Now we can put a break to first function <code>start_status</code> to check if the first tracepoint is successful.
To show all the tracepoints we can use <code>uk trace</code>.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>GDB configuration</h4>Don&rsquo;t forget to put this line <code>source /path/to/your/build/uk-gdb.py</code> in your GDB file configuration <code>~/.gdbinit</code>.
Otherwise you won&rsquo;t be able to use <code>uk trace</code>.</div><pre><code>(gdb) break start_status
(gdb) continue
(gdb) uk trace
0000116012362374 start_trace: 2
</code></pre><p>We notice that we got an output and that the tracepoint was reached.
We continue until the second trace point and we will save all the tracepoints obtained with the command <code>uk trace save traces.dat</code></p><pre><code>(gdb) break stop_status
(gdb) continue
(gdb) uk trace save traces.dat
Saving traces to traces.dat ...
</code></pre><p>Now we can read all the tracepoints obtained using <code>trace.py</code> from the main repo located in <code>unikraft/support/scripts/uk_trace/trace.py</code>.
The output will be similar to this:</p><pre><code>       time  tp_name        msg
-----------  -----------  -----
 5321091993  start_trace      2
11121071844  stop_trace       2
</code></pre><h3 id=05-can-you-trace-your-own-program>05. Can you trace your own program?</h3><p>Modify your <code>Echo-back Server</code> application implemented in the <a href=https://usoc21.unikraft.org/docs/sessions/01-baby-steps/#01-echo-back-server>first</a> session so that each time the server responds with a message a tracepoint with the corresponding message will be activated.
Save all your tracepoints in a <code>traces.dat</code> file and show them in a user-friendly view with <code>trace.py</code>.</p><h3 id=06-nginx-with-or-without-main-thats-the-question>06. Nginx with or without main? That&rsquo;s the question.</h3><p>Let&rsquo;s try a new application based on networking, <strong>Nginx</strong>.</p><p>First clone the repository for <a href=https://github.com/unikraft/app-nginx>app-nginx</a> and put it in the right hierarchy.
Then you need to create <code>Makefile</code> and <code>Makefile.uk</code>.
Make sure to respect the order of libraries in <code>Makefile</code>. For more information check <a href=https://github.com/unikraft/lib-nginx>lib-nginx</a> repository.</p><p>Do you observe something strange? Where is the <code>main.c</code>?</p><p>Deselect this option <code>Library Configuration</code> -> <code>libnginx</code> -> <code>Provide a main function</code> and try to make your own <code>main.c</code> that will run <strong>Nginx</strong>.</p><ul><li>Nginx + Makefile</li><li>Nginx without <code>provide main function</code></li></ul><h3 id=07-bonus-bad-elf-in-town>07. Bonus. Bad ELF in Town</h3><p>We managed to build an ELF file that is valid when doing static analysis, but that can&rsquo;t be executed.
The file is <code>bad_elf</code>, located in the <code>work/07-bad-elf/</code> folder.</p><p>Running it triggers a segmentation fault message.
Running it using <code>strace</code> show an error with <code>execve()</code>.</p><pre><code>~/Doc/U/summer-of-code-2021/c/e/d/s/0/w/05-bad-elf &gt; ./bad_elf
[1]    125458 segmentation fault  ./bad_elf
~/Doc/U/summer-of-code-2021/c/e/d/s/0/w/05-bad-elf &gt; strace ./bad_elf
execve(&quot;./bad_elf&quot;, [&quot;./bad_elf&quot;], 0x7ffc9ca2e960 /* 66 vars */) = -1 EINVAL (Invalid argument)
+++ killed by SIGSEGV +++
[1]    125468 segmentation fault (core dumped)  strace ./bad_elf

</code></pre><p>The ELF file itself is valid.
You can check using <code>readelf</code>:</p><pre><code>$ readelf -a ./bad_elf
</code></pre><p>The issue is to be detected in the kernel.
Use either <a href=https://www.brendangregg.com/perf.html><code>perf</code></a>, or, better yet <a href=https://jvns.ca/blog/2017/03/19/getting-started-with-ftrace/><code>ftrace</code></a> to inspect the kernel function calls done by the program.
Identify the function call that sends out the <code>SIGSEGV</code> signal.
Identify the cause of the issue.
Find that cause in the <a href=https://linux.die.net/man/5/elf>manual page <code>elf(5)</code></a>.</p><h3 id=08-give-us-feedback>08. Give Us Feedback</h3><p>We want to know how to make the next sessions better.
For this we need your <a href=https://forms.gle/9EuzgL1n244Mvqfq8>feedback</a>.
Thank you!</p><h2 id=further-reading>Further Reading</h2><ul><li><a href=https://sourceware.org/gdb/wiki/Internals/Breakpoint%20Handling>Hardware Breakpoint</a></li><li><a href=https://01.org/linuxgraphics/gfx-docs/drm/trace/tracepoints.html>Tracepoints</a></li><li><a href=https://users.ece.utexas.edu/~adnan/gdb-refcard.pdf>GDB Cheatsheet</a></li><li><a href=https://en.wikipedia.org/wiki/X86_calling_conventions>X86_64 calling convention</a></li></ul><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/unikraft/summer-of-code-2021/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/unikraft/summer-of-code-2021/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified August 31, 2021: <a href=https://github.com/unikraft/summer-of-code-2021/commit/09e3b47a9e82aec0caf7e6ba1e9732800b1813c7>Fix typos and missing dots (09e3b47)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel="noopener noreferrer" href=https://bit.ly/UnikraftDiscord><i class="fab fa-discord"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/UnikraftSDK><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/unikraft/unikraft><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel="noopener noreferrer" href=https://linkedin.com/company/unikraft-sdk><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 Unikraft and Open-Source Contributors. All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>