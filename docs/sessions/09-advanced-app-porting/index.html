<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Session 09: Advanced App Porting | Unikraft Summer of Code 2021</title><meta property="og:title" content="Session 09: Advanced App Porting"><meta property="og:description" content="Reminders At this stage, you should be familiar with the steps of configuring, building and running any application within Unikraft and know the main parts of the architecture. Below you can see a list of the commands you have used so far, and will be useful in today&rsquo;s session as well.
   Command Description     make clean Clean the application   make properclean Clean the application, fully remove the build/ folder   make distclean Clean the application, also remove ."><meta property="og:type" content="article"><meta property="og:url" content="/docs/sessions/09-advanced-app-porting/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2021-09-03T15:53:42+03:00"><meta property="og:site_name" content="Unikraft Summer of Code 2021"><meta itemprop=name content="Session 09: Advanced App Porting"><meta itemprop=description content="Reminders At this stage, you should be familiar with the steps of configuring, building and running any application within Unikraft and know the main parts of the architecture. Below you can see a list of the commands you have used so far, and will be useful in today&rsquo;s session as well.
   Command Description     make clean Clean the application   make properclean Clean the application, fully remove the build/ folder   make distclean Clean the application, also remove ."><meta itemprop=dateModified content="2021-09-03T15:53:42+03:00"><meta itemprop=wordCount content="3379"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Session 09: Advanced App Porting"><meta name=twitter:description content="Reminders At this stage, you should be familiar with the steps of configuring, building and running any application within Unikraft and know the main parts of the architecture. Below you can see a list of the commands you have used so far, and will be useful in today&rsquo;s session as well.
   Command Description     make clean Clean the application   make properclean Clean the application, fully remove the build/ folder   make distclean Clean the application, also remove ."><link rel=preload href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css as=style><link href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Unikraft Summer of Code 2021</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Workshop</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center d-lg-none"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Workshop</a></li><ul><li class="collapse show" id=docs><a class="td-sidebar-link td-sidebar-link__page" id=m-docssessionsschedule href=/docs/sessions/schedule/>Schedule</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsoverviewpeople href=/docs/overview/people/>People</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions01-baby-steps href=/docs/sessions/01-baby-steps/>01. Baby Steps</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions02-behind-scenes href=/docs/sessions/02-behind-scenes/>02. Behind the Scenes</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions03-debugging href=/docs/sessions/03-debugging/>03. Debugging in Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions04-complex-applications href=/docs/sessions/04-complex-applications/>04. Complex Applications</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions05-contributing-to-unikraft href=/docs/sessions/05-contributing-to-unikraft/>05. Contributing to Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions06-testing-unikraft href=/docs/sessions/06-testing-unikraft/>06. Testing Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions07-syscall-shim href=/docs/sessions/07-syscall-shim/>07. Syscall Shim</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions08-basic-app-porting href=/docs/sessions/08-basic-app-porting/>08. Basic App Porting</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-docssessions09-advanced-app-porting href=/docs/sessions/09-advanced-app-porting/>09. Advanced App Porting</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions10-high-performance href=/docs/sessions/10-high-performance/>10. High Performance</a></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/unikraft/summer-of-code-2021/edit/master/content/en/docs/sessions/09-advanced-app-porting/index.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/unikraft/summer-of-code-2021/new/master/content/en/docs/sessions/09-advanced-app-porting/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/unikraft/summer-of-code-2021/issues/new?title=Session%2009:%20Advanced%20App%20Porting" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/unikraft/unikraft/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
<a id=print href=/docs/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><nav id=TableOfContents><ul><li><a href=#reminders>Reminders</a></li><li><a href=#overview>Overview</a><ul><li><a href=#adding-new-sections-to-an-elf>Adding New Sections to an ELF</a></li><li><a href=#unikraft-apis>Unikraft APIs</a></li></ul></li><li><a href=#practical-work>Practical Work</a><ul><li><a href=#support-files>Support Files</a></li><li><a href=#01-add-extra-section-in-the-elf>01. Add Extra Section in the ELF</a></li><li><a href=#02-using-readelf>02. Using <code>readelf</code></a></li><li><a href=#03-searching-symbols>03. Searching Symbols</a></li><li><a href=#04-myramfs-register-the-filesystem>04. MyRamfs. Register the Filesystem.</a></li><li><a href=#05-myramfs-building-the-structure>05. MyRamfs. Building the Structure</a></li><li><a href=#06-myramfs-reading-and-writing>06. MyRamfs. Reading and Writing</a></li><li><a href=#07-give-us-feedback>07. Give Us Feedback</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Workshop</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/sessions/09-advanced-app-porting/>09. Advanced App Porting</a></li></ol></nav><div class=td-content><h1>Session 09: Advanced App Porting</h1><h2 id=reminders>Reminders</h2><p>At this stage, you should be familiar with the steps of configuring, building and running any application within Unikraft and know the main parts of the architecture.
Below you can see a list of the commands you have used so far, and will be useful in today&rsquo;s session as well.</p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>make clean</code></td><td>Clean the application</td></tr><tr><td><code>make properclean</code></td><td>Clean the application, fully remove the <code>build/</code> folder</td></tr><tr><td><code>make distclean</code></td><td>Clean the application, also remove <code>.config</code></td></tr><tr><td><code>make menuconfig</code></td><td>Configure application through the main menu</td></tr><tr><td><code>make</code></td><td>Build configured application (in <code>.config</code>)</td></tr><tr><td><code>qemu-guest -k &lt;kernel_image></code></td><td>Start the unikernel</td></tr><tr><td><code>qemu-guest -k &lt;kernel_image> -e &lt;directory></code></td><td>Start the unikernel with a filesystem mapping of <code>fs0</code> id from <code>&lt;directory></code></td></tr><tr><td><code>qemu-guest -k &lt;kernel_image> -g &lt;port> -P</code></td><td>Start the unikernel in debug mode, with GDB server on port <code>&lt;port></code></td></tr></tbody></table><h2 id=overview>Overview</h2><p>As programs may grow quite complicated, porting them requires a thorough grasp of Unikraft core components, and in certain cases, the addition of new ones.
In this session, we&rsquo;ll take a closer look at Unikraft&rsquo;s core libraries and APIs.</p><h3 id=adding-new-sections-to-an-elf>Adding New Sections to an ELF</h3><p>There are situations in which we want to add new sections in the executable file (ELF format - <em>Executable and Linking Format</em>) for our application or library.
The reason these sections are useful is that the library (or application) becomes much easier to configure, thus serving more purposes.
For example, the Unikraft virtual filesystem (i.e. the <code>vfscore</code> library) uses such a section in which it registers the used filesystem (<code>ramfs</code>, <code>9pfs</code>), and we are going to discuss this in the following sections.
Another component that makes use of additional sections is the scheduler.
The scheduler interface allows us to register a set of functions at build time that will be called when a thread is created or at the end of its execution.</p><p>The way we can add such a section in our application/library is the following:</p><ol><li><p>Create a file with the <code>.ld</code> extension (e.g. extra.ld) with the following content:</p><pre><code>SECTIONS
{
	.my_section : {
     PROVIDE(my_section_start = .);
         KEEP (*(.my_section_entry))
         PROVIDE(my_section_end = .);
	}
}
INSERT AFTER .text;
</code></pre></li><li><p>Add the following line to <code>Makefile.uk</code>:</p><pre><code>LIBYOURAPPNAME_SRCS-$(CONFIG_LIBYOURAPPNAME) += $(LIBYOURAPPNAME_BASE)/extra.ld
</code></pre><p>This will add the <code>.my_section</code> section after the <code>.text</code> section in the ELF file.
The <code>.my_section_entry</code> field will be used to register an entry in this section, and access to it is generally gained via traversing the section&rsquo;s endpoints (i.e. from <code>my_section_start</code> to <code>my_section_end</code>).</p></li></ol><p>But enough with the chit-chat, let&rsquo;s get our hands dirty.
In the <code>/demo/01-extrald-app</code> directory there is an application that defines a new section in the ELF.
Copy this directory to your app&rsquo;s directory.
Your working directory should look like this:</p><pre><code>workdir
|_______apps
|       |_______01-extrald-app
|_______libs
|_______unikraft
</code></pre><p>Before running the program let&rsquo;s analyze the source code.
Look in the <code>main.c</code> file.
We want to register the <code>my-structure</code> structure in the newly added section.
In Unikraft core libraries this is usually done using macros.
So we will do the same.</p><pre><code>#define MY_REGISTER(s, f) static const struct my_structure      \
        __section(&quot;.my_section_entry&quot;)                          \
        __my_section_var __used =                               \
                {.name = (s),                                   \
                .func = (f)};
</code></pre><p>This macro receives the fields of the structure and defines a variable called <code>__my_section_var</code> in the newly added section.
This is done via <code>__section()</code>.
We also use the <code>__used</code> attribute to tell the compiler not to optimize out the variable.
Note that this macro uses different compiler attributes.
Most of these are in <code>uk/essentials.h</code>, so please make sure you include it when working with macros.</p><p>Next, let&rsquo;s analyze the method by which we can go through this section to find the entries.
We must first import the endpoints of the section.
It can be done as follows:</p><pre><code>extern const struct my_structure my_section_start;
extern const struct my_structure my_section_end;
</code></pre><p>Using the endpoints we can write the macro for iterating through the section:</p><pre><code>#define for_each_entry(iter)                                    \
        for (iter = &amp;my_section_start;                          \
                iter &lt; &amp;my_section_end;                         \
                iter++)

</code></pre><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4>If you&rsquo;re not familiar with macros, you may check what they expand to with the GCC&rsquo;s preprocessor.
Remove all the included headers and run <code>gcc -E main.c</code>.</div><p>Let&rsquo;s configure the program.
Use the <code>make menuconfig</code> command to set the KVM platform as in the following image.</p><p><img src=./images/platform_configuration.png alt=platform_configuration></p><p>Save the configuration, exit the menuconfig tab and run <code>make</code>.
Now, let&rsquo;s run it.
You can use the following command:</p><pre><code>$ qemu-guest -k build/01-extrald-app_kvm-x86_64
</code></pre><p>The program&rsquo;s output should be the following:</p><p><img src=./images/01-extrald-app-output.png alt=01-extrald-app-output></p><p>To see that the information about the section size and its start address is correct we will examine the binary using the readelf utility.
The readelf utility is used to display information about ELF files, like sections or segments.
More about it <a href=https://man7.org/linux/man-pages/man1/readelf.1.html>here</a>
Use the following command to display information about the ELF sections:</p><pre><code>$ readelf -S build/01-extrald-app_kvm-x86_64
</code></pre><p>The output should look like this:</p><p><img src=./images/readelf_output.png alt=readelf_output></p><p>We can see that <code>my_section</code> is indeed among the sections of the ELF.
Looking at its size we see that it is 0x10 bytes (the equivalent of 16 in decimal).
We also notice that the start address of the section is 0x1120f0, the same as the one we got from running the program.</p><h3 id=unikraft-apis>Unikraft APIs</h3><p>One important thing to point out regarding Unikraft internal libraries is that for each &ldquo;category&rdquo; of library (e.g., memory allocators, schedulers, filesystems, network drivers, etc.)
Unikraft defines (or will define) an API that each library under that category must comply with.
This is so that it&rsquo;s possible to easily plug and play different libraries of a certain type (e.g., using a co-operative scheduler or a pre-emptive one).</p><h4 id=vfscore>VFScore</h4><p>Take for example the virtual filesystem (i.e. <code>vfscore</code>).
This library provides the implementation of system calls related to filesystem management.
We saw in previous sessions that there are two types of filesystems available in Unikraft <code>ramfs</code> and<code> 9pfs</code>.
Obviously, these two have different implementations of generic file operations, such as reading, writing, etc.
The natural question is: how can we have the same API for system calls (e.g. <code>read</code>,<code> write</code>) but with configurable functionalities?
The answer is by mapping system calls to different implementations.
This is done by using function pointers that redirect the program&rsquo;s flow to the functions we have defined.</p><p>In this regard, the <code>vfscore</code> library provides 2 structures to define operations on the filesystem:</p><pre><code>struct vfsops {
        int (*vfs_mount)        (struct mount *, const char *, int, const void *);
        ...
        struct vnops    *vfs_vnops;
};
</code></pre><pre><code>struct vnops {
        vnop_open_t             vop_open;
        vnop_close_t            vop_close;
        vnop_read_t             vop_read;
        vnop_write_t            vop_write;
        vnop_seek_t             vop_seek;
        vnop_ioctl_t            vop_ioctl;
        ...
};
</code></pre><p>The first structure mainly defines the operation of mounting the filesystem, while the second defines the operations that can be executed on files (regular files, directories, etc).
The <code>vnops</code> structure can be seen as the <code>file_operation</code> structure in the Linux Kernel (more as an idea).
More about this structure <a href=https://tldp.org/LDP/lkmpg/2.4/html/c577.htm>here</a>.</p><p>The filesystem library will define two such structures through which it will provide the specified operations.
To understand how these operations end up being used let&rsquo;s examine the open system call:</p><pre><code>int
sys_open(char *path, int flags, mode_t mode, struct vfscore_file **fpp)
{
        struct vfscore_file *fp;
        struct vnode *vp;
        ...
        error = VOP_OPEN(vp, fp);
}
</code></pre><p><code>VOP_OPEN()</code> is a macro that is defined as follows:</p><pre><code>#define VOP_OPEN(VP, FP)           ((VP)-&gt;v_op-&gt;vop_open)(FP)
</code></pre><p>So the system call will eventually call the registered operation.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4><p>In order to find the source that contains the definition of a structure, function or other component in the <code>unikraft</code> directory you can use the following command:</p><pre><code>$ grep -r &lt;what_you_want_to_search_for&gt;
</code></pre><p>For example:</p><p><img src=./images/grep_r_usage.png alt=grep_r_usage></p></div><p>Let&rsquo;s see now how to link the &ldquo;file operations&rdquo; of a filesystem to the <code>vfscore</code> library.
For this, the library exposes a specific structure named <code>vfscore_fs_type</code>:</p><pre><code>struct vfscore_fs_type {
        const char      *vs_name;       /* name of file system */
        int             (*vs_init)(void); /* initialize routine */
        struct vfsops   *vs_op;         /* pointer to vfs operation */
};
</code></pre><p>Notice that this structure contains a pointer to the <code>vfsops</code> structure, which in turn contains the <code>vnops</code> structure.
To register a filesystem, the <code>vfscore</code> library uses an additional section in the ELF.
You can inspect the <code>extra.ld</code> file, in the <code>vfscore</code> directory to see it.
As we mentioned before, these sections come with help macros, so this time is no exception either.
The macro that registers a filesystem is:</p><pre><code> UK_FS_REGISTER(fssw)
</code></pre><p>Where the <code>fssw</code> argument is a <code>vfscore_fs_type</code> structure.</p><p>There are three other important structures that we should discuss.
First of all, the <code>vnode</code> structure.
This is the abstraction that <code>vfscore</code> provides for a file (no matter its nature, regular, directory, etc), and it can be seen as the equivalent of an inode in Linux-based systems.</p><pre><code>struct vnode {
        uint64_t        v_ino;          /* inode number */
        struct mount    *v_mount;       /* mounted vfs pointer */
        struct vnops    *v_op;          /* vnode operations */
        mode_t          v_mode;         /* file mode */
        off_t           v_size;         /* file size */
        ...
        void            *v_data;        /* private data for fs */
};
</code></pre><p>This structure maintains the metadata of the file, such as the operations we can perform on it, permissions, or the size of the file.
In addition to this, we notice the existence of a <strong>void pointer field</strong> which is used to keep a reference to the specific structures of the filesystem.
This field is used by the two available filesystems and we will use it today in our practical work.</p><p>The <code>dentry</code> structure is the second relevant structure. It offers the possibility to create links (although currently neither <code>ramfs</code> or <code>9pfs</code> does not support hard links).
A dentry can be seen as the equivalent of a path in the filesystem, and it has a pointer to the inode.</p><pre><code>struct dentry {
        char            *d_path;        /* pointer to path in fs */
        struct vnode    *d_vnode;       /* pointer to inode */
        ...
};
</code></pre><p>One thing to point out is that an inode is deleted only when there are no dentries that reference it.</p><p>Last but not least is the <code>mount</code> structure.
Mounting filesystems is the process by which the user makes the contents of a filesystem accessible.
From this point of view, the filesystem, for example, <code>ramfs</code>, is seen as a device on Linux to which we have to associate a directory (technically speaking a dentry).</p><pre><code>struct mount {
        struct vfsops   *m_op;          /* pointer to vfs operation */
        int             m_flags;        /* mount flag */
        char            m_path[PATH_MAX]; /* mounted path */
        ...
        struct dentry   *m_root;        /* root vnode */
};
</code></pre><p>Notice that the mount structure does have a dentry which will point to the inode describing the root directory.</p><h4 id=ramfs>RAMFS</h4><p>Now that we have seen the API of the virtual filesystem, let&rsquo;s go deeper into the hierarchy and look at the implementation of the ramfs filesystem.
For storage, this uses, as the name implies, the memory.
Its advantage is that it is very fast, the disadvantage you probably already guessed it&mldr; From a simplified perspective we can look at a file in ramfs as a buffer in memory.
But wait a minute, if a file is just a memory buffer, doesn&rsquo;t going through so many layers of code mean overhead?
Bien sûr, mi amigo! But having these methods of abstraction makes our work easier in terms of porting an application.
There are applications that need a small filesystem, although the source code is not very easy.
Then we prefer a little overhead than trying to patch the code.</p><p>Let&rsquo;s see how the ramfs system is registered into <code>vfscore</code>. We inspect the code from the <code>ramfs_vfsops.c</code> file from <code>ramfs</code> directory:</p><pre><code>static struct vfscore_fs_type fs_ramfs = {
        .vs_name = &quot;ramfs&quot;,
        .vs_init = NULL,
        .vs_op = &amp;ramfs_vfsops,
};

UK_FS_REGISTER(fs_ramfs);
</code></pre><p>It defines the <code>vfscore_fs_type</code> structure and uses the registration macro for the corresponding section.</p><p>Next, let&rsquo;s look at the specific structure, which is essentially the &ldquo;file&rdquo;:</p><pre><code>struct ramfs_node {
        struct ramfs_node *rn_next;   /* next node in the same directory */
        struct ramfs_node *rn_child;  /* first child node */
        int rn_type;    /* file or directory */
        char *rn_name;    /* name (null-terminated) */
        char *rn_buf;    /* buffer to the file data */
        size_t rn_bufsize;    /* allocated buffer size */
        ...
};
</code></pre><p>This structure contains the file type, the buffer in which the data will be stored, and its size.
A field that normally should not be here is the name, but for the simplicity of the library, it is used.
Unfortunately, the fact that the name field is here and is used in the code does not allow the creation of hard links.</p><p>We notice that the filesystem has the following tree-like structure:</p><p><img src=./images/ramfs_structure.png alt=ramfs_strucutre></p><p>Let&rsquo;s look at how the filesystem is mounted.
In the boot process, the mount syscall from <code>vfscore</code> is called.
This is redirected to the <code>ramfs_mount</code> function as follows:</p><pre><code>UK_SYSCALL_R_DEFINE(int, mount, const char*, dev, const char*, dir,
                const char*, fsname, unsigned long, flags, const void*, data)
{
        ...
        /*
         * Call a file system specific routine.
         */
        if ((error = VFS_MOUNT(mp, dev, flags, data)) != 0)
                goto err4;
        ...
}
</code></pre><p>Now let&rsquo;s examine this specific routine:</p><pre><code>/*
 * Mount a file system.
 */
static int
ramfs_mount(struct mount *mp, const char *dev __unused,
            int flags __unused, const void *data __unused)
{
        struct ramfs_node *np;

        /* Create a root node */
        np = ramfs_allocate_node(&quot;/&quot;, VDIR);

        mp-&gt;m_root-&gt;d_vnode-&gt;v_data = np;

        return 0;
}
</code></pre><p>If we go back to the 3 important structures of <code>vfscore</code>, <code>mount</code>, <code>dentry</code> and <code>vnode</code> we notice this call provides the upper layer the possibility to explore all the file hierarchy.</p><p>The reason why it is important to do the <code>vnode</code> - <code>ramfs_node</code> association is that most operations are done on vnodes.
Thus, in the first phases of a defined operation, references to the <code>ramfs_node</code> field are usually found.
For example:</p><pre><code>static int
ramfs_read(struct vnode *vp, struct vfscore_file *fp __unused,
           struct uio *uio, int ioflag __unused)
{
        struct ramfs_node *np =  vp-&gt;v_data;
        ...
}
</code></pre><h4 id=generic-list-api-in-unikraft>Generic List API in Unikraft</h4><p>Unikraft has an implementation of generic lists similar to those in the Linux kernel.
To use this API, one must include the <code>uk/list.h</code> header.
This type of structure is important because it is a unified way of using linked lists, which is why it is useful to know it, especially if we are working in the Unikraft core.
The <code>uk_list_head</code> structure looks as follows:</p><pre><code>struct uk_list_head {
        struct uk_list_head *next;
        struct uk_list_head *prev;
};
</code></pre><p>The way these lists are built exploits the way of defining structures in C.
A field in a structure is actually just an offset in memory.
To define a list, for example, we just need to include the <code>uk_list_head</code> structure in our container structure:</p><pre><code>struct car {
        char name[50];
        struct uk_list_head list;
};
</code></pre><p>All the list operations, adding, removing, traversing will be performed on the list field.</p><p>The usual routines from this API are:</p><ol><li><code>UK_LIST_HEAD(name)</code> declare the sentinel of a list globally.</li><li><code>UK_INIT_LIST_HEAD(struct uk_list_head *list)</code> declare the sentinel of a list dynamically (i.e. can be used inside a function).</li><li><code>uk_list_add(struct uk_list_head *new_entry, struct uk_list_head *head)</code> add a new entry to the list.</li><li><code>uk_list_entry(ptr, type, field)</code> returns the structure with the type <strong>type</strong> that contains the element <strong>ptr</strong> from the list, having the name <strong>field</strong> within the structure.</li><li><code>uk_list_for_each(p, head)</code> iterates over a list using <strong>p</strong> as a cursor.</li><li><code>uk_list_for_each_safe(p, n, head)</code> iterates over a list using <strong>p</strong> as a cursor and <strong>n</strong> as a temporary cursor.
This is useful for deletion.</li></ol><p>In the <code>/demo/02-linked-list-app</code> directory there is an application that uses generic lists.
Copy this directory to your app&rsquo;s directory.
Run <code>make menuconfig</code> and select the KVM platform.
After that run <code>make</code>.
You can start the program using the following command:</p><pre><code>$ qemu-guest -k build/02-linked-list-app_kvm-x86_64
</code></pre><p>Let&rsquo;s look at the following part of the code:</p><pre><code>        printf(&quot;\nThe structure address for c1 is: %p\n&quot;, c1);
        zero = (struct car *) 0;
        printf(&quot;The offset of list field inside car strucure is: %p\n&quot;,
                &amp;zero-&gt;list);
        printf(&quot;The list field address for c1 is: %p\n&quot;,
                &amp;c1-&gt;list);
        printf(&quot;The address of c1 based on calculation is %p\n&quot;,
                (void *) ((void *) &amp;c1-&gt;list - (void *) &amp;zero-&gt;list));
</code></pre><p>In this part we calculate the offset of the <code>list</code> field within the <code>car</code> structure, which we subtract from the actual address of the <code>list</code> field inside the structure to determine the start address.
This is precisely the way <code>uk_list_entry</code> macro works.</p><h2 id=practical-work>Practical Work</h2><p>All tasks are in the <code>work</code> directory.</p><h3 id=support-files>Support Files</h3><p>Session support files are available <a href=https://github.com/unikraft/summer-of-code-2021>in the repository</a>.
If you already cloned the repository, update it and enter the session directory:</p><pre><code>$ cd path/to/repository/clone

$ git pull --rebase

$ cd content/en/docs/sessions/09-advanced-app-porting/

$ ls
demo/  images/  index.md/  sol/  work/
</code></pre><p>If you haven&rsquo;t cloned the repository yet, clone it and enter the session directory:</p><pre><code>$ git clone https://github.com/unikraft/summer-of-code-2021

$ cd summer-of-code-2021/content/en/docs/sessions/09-advanced-app-porting/

$ ls
demo/  images/  index.md/  sol/  work/
</code></pre><h3 id=01-add-extra-section-in-the-elf>01. Add Extra Section in the ELF</h3><p>In this task we will add a new section in the elf and we will define a series of macros.</p><p>Navigate to the <code>01-extrald</code> directory.
Copy <code>mycorelibrary</code> to the <code>lib</code> directory in <code>unikraft</code> and the two applications in the <code>apps</code> directory.
Your working directory should look like this:</p><pre><code>workdir
|_______apps
|       |_______01-app
|       |_______02-app
|_______libs
|_______unikraft
        |_______lib
                |_______mycorelib
                |_______Makefile.uk
</code></pre><p>Edit the <code>Makefile.uk</code> from the <code>lib</code> directory and add the following:</p><pre><code>$(eval $(call _import_lib,$(CONFIG_UK_BASE)/lib/mycorelib))
</code></pre><p>Follow the TODOs from the sources and headers.
After solving all the TODOs compile both applications and run them.
Don&rsquo;t forget to <code>make menuconfig</code> to select <code>mycorelib</code> and the KVM platform.</p><h3 id=02-using-readelf>02. Using <code>readelf</code></h3><p>Use the <code>readelf</code> utility to see the section&rsquo;s address and size and check them with the program&rsquo;s output (like we did in the demo).</p><h3 id=03-searching-symbols>03. Searching Symbols</h3><p>Using the <code>grep</code> utility search the following and inspect the source code:</p><ol><li><code>struct vfsops</code>, <code>struct vnops</code>, <code>struct vfscore_fs_type</code></li><li><code>struct vnode</code>, <code>struct dentry</code>, <code>struct mount</code></li><li><code>sys_open</code> look especially for VOP macros.
How many operations does the open system call do?</li><li><code>vfscore_vget</code> can you figure it out what this function does?</li></ol><h3 id=04-myramfs-register-the-filesystem>04. MyRamfs. Register the Filesystem.</h3><p>In the following exercises, we will build step by step a simplified version of the ramfs library.
The first step is to register the filesystem into <code>vfscore</code>.</p><p>Navigate to the <code>04-05-06-myramfs</code> directory.
Copy <code>myramfs</code> directory to the <code>lib</code> directory in <code>unikraft</code> and the application in the <code>apps</code> directory.
Your working directory should look like this:</p><pre><code>workdir
|_______apps
|       |_______ramfs-app
|_______libs
|_______unikraft
        |_______lib
                |_______myramfs
                |_______vfscore
                |_______Makefile.uk
</code></pre><p>Edit the <code>Makefile.uk</code> from the <code>lib</code> directory and add the following:</p><pre><code>$(eval $(call _import_lib,$(CONFIG_UK_BASE)/lib/myramfs))
</code></pre><p>Now we need to make our library configurable from <code>vfscore</code>, for this we will need to edit the <code>Config.uk</code> file in the <code>vfscore</code> directory.</p><p>First we will add the configuration menu:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#ce5c00;font-weight:700>...</span>
<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>LIBVFSCORE_AUTOMOUNT_ROOTFS</span>
        <span style=color:#000>choice</span> <span style=color:#000>LIBVFSCORE_ROOTFS</span>
        <span style=color:#000>prompt</span> <span style=color:#4e9a06>&#34;Default root filesystem&#34;</span>

                <span style=color:#000>config</span> <span style=color:#000>LIBVFSCORE_ROOTFS_RAMFS</span>
                <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#4e9a06>&#34;RamFS&#34;</span>
                <span style=color:#204a87;font-weight:700>select</span> <span style=color:#000>LIBRAMFS</span>

<span style=display:block;width:100%;background-color:#dfdfdf>                <span style=color:#000>config</span> <span style=color:#000>LIBVFSCORE_ROOTFS_MYRAMFS</span>
</span><span style=display:block;width:100%;background-color:#dfdfdf>                <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#4e9a06>&#34;My-ramfs&#34;</span>
</span><span style=display:block;width:100%;background-color:#dfdfdf>                <span style=color:#204a87;font-weight:700>select</span> <span style=color:#000>LIBMYRAMFS</span>
</span><span style=color:#ce5c00;font-weight:700>...</span></code></pre></div><p>If we run now <code>make menuconfig</code> in the application <code>ramfs-app</code> we should see our library under the <code>vfscore configuration</code>:</p><p><img src=./images/vfscore_config_myramfs.png alt=vfscore_config_myramfs></p><p>The second fundamental step is to add the following line to the same <code>Config.uk</code> file:<div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go> <span style=color:#a40000>#</span> <span style=color:#000>Hidden</span> <span style=color:#000>configuration</span> <span style=color:#000>option</span> <span style=color:#000>that</span> <span style=color:#000>gets</span> <span style=color:#000>automatically</span> <span style=color:#000>filled</span>
        <span style=color:#a40000>#</span> <span style=color:#000>with</span> <span style=color:#000>the</span> <span style=color:#000>selected</span> <span style=color:#000>filesystem</span> <span style=color:#000>name</span>
        <span style=color:#000>config</span> <span style=color:#000>LIBVFSCORE_ROOTFS</span>
        <span style=color:#204a87;font-weight:700>string</span>
        <span style=color:#204a87;font-weight:700>default</span> <span style=color:#4e9a06>&#34;ramfs&#34;</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>LIBVFSCORE_ROOTFS_RAMFS</span>
<span style=display:block;width:100%;background-color:#dfdfdf>        <span style=color:#204a87;font-weight:700>default</span> <span style=color:#4e9a06>&#34;myramfs&#34;</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>LIBVFSCORE_ROOTFS_MYRAMFS</span>
</span>        <span style=color:#204a87;font-weight:700>default</span> <span style=color:#4e9a06>&#34;9pfs&#34;</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>LIBVFSCORE_ROOTFS_9PFS</span>
        <span style=color:#204a87;font-weight:700>default</span> <span style=color:#4e9a06>&#34;initrd&#34;</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>LIBVFSCORE_ROOTFS_INITRD</span>
        <span style=color:#204a87;font-weight:700>default</span> <span style=color:#000>LIBVFSCORE_ROOTFS_CUSTOM_ARG</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>LIBVFSCORE_ROOTFS_CUSTOM</span></code></pre></div></p><p>This will fill the <code>CONFIG_LIBVFSCORE_ROOTFS</code> with the string <code>myramfs</code>.</p><p>Now that we&rsquo;ve done our setup, let&rsquo;s get started.
Follow TODOs 1-4 in myramfs_vnops.c and myramfs_vfsops.c.
Now, when you run <code>make menuconfig</code> in the app be sure you use the <code>myramfs</code>library and also check the debug library.
If everything is fine you should get a similar output:</p><p><img src=./images/04_output.png alt=04_output></p><div class="alert alert-primary" role=alert><h4 class=alert-heading>Note</h4>Try to rename the filesystem in the <code>vfscore_fs_type</code> structure. What happens? Look for the <code>fs_getfs</code> function.</div><h3 id=05-myramfs-building-the-structure>05. MyRamfs. Building the Structure</h3><p>The <code>ramfs</code> library has a tree-like structure, as we saw in the section dedicated to it.
Our library will be in the form of a list for ease of use.
We&rsquo;ll use the generic lists given before to make it even prettier.
This indicates that only ordinary files, not directories, are supported.</p><p>For this task we will still look in the files <code>myramfs_vfsops.c</code> and <code>myramfs_vnops.c</code> and we will perform the TODOs from 5 to 13.
But first we recommend you to look at the <code>struct myramfs_node</code> which is in the <code>myramfs.h</code> file.</p><p>To test this task go back to the <code>ramfs-app</code> and build it again (make sure to properclean).
If you solved everything correctly the output should look like this:</p><p><img src=./images/05_output.png alt=05_output></p><h3 id=06-myramfs-reading-and-writing>06. MyRamfs. Reading and Writing</h3><p>In today&rsquo;s last exercise we will really do what is done most with files, we write and read. Follow TODOs 14, 15 from <code>myramfs_vnops.c</code>.</p><div class="alert alert-primary" role=alert><h4 class=alert-heading>HINT</h4>Check <code>struct uio</code> structure and the <code>vfscore_uiomove</code> routine.</div><h3 id=07-give-us-feedback>07. Give Us Feedback</h3><p>We want to know how to make the next sessions better.
For this we need your <a href=https://docs.google.com/forms/d/1FW1mzu19G7A1okzkssNctjgMUDsUyMvIvDvIO1Yr6Xo/edit>feedback</a>.</p><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/unikraft/summer-of-code-2021/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/unikraft/summer-of-code-2021/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified September 3, 2021: <a href=https://github.com/unikraft/summer-of-code-2021/commit/b92678d4d43732805b1058bed97a3af23721b1dc>10-high-perf: Review session contents (b92678d)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel="noopener noreferrer" href=https://bit.ly/UnikraftDiscord><i class="fab fa-discord"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/UnikraftSDK><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/unikraft/unikraft><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel="noopener noreferrer" href=https://linkedin.com/company/unikraft-sdk><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 Unikraft and Open-Source Contributors. All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>