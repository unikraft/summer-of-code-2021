<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Session 06: Testing Unikraft | Unikraft Summer of Code 2021</title><meta property="og:title" content="Session 06: Testing Unikraft"><meta property="og:description" content="00. The Concept of Testing In this session, we are going to explore the idea of validation by testing. Even though our main focus will be testing, we&rsquo;ll also tackle other validation methods such as fuzzing and symbolic execution. Before diving into how we can do testing on Unikraft, let&rsquo;s first focus on several key concepts that are used when talking about testing.
There are three types of testing: unit testing, integration testing and end-to-end testing."><meta property="og:type" content="article"><meta property="og:url" content="/docs/sessions/06-testing-unikraft/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2021-08-31T21:11:29+02:00"><meta property="og:site_name" content="Unikraft Summer of Code 2021"><meta itemprop=name content="Session 06: Testing Unikraft"><meta itemprop=description content="00. The Concept of Testing In this session, we are going to explore the idea of validation by testing. Even though our main focus will be testing, we&rsquo;ll also tackle other validation methods such as fuzzing and symbolic execution. Before diving into how we can do testing on Unikraft, let&rsquo;s first focus on several key concepts that are used when talking about testing.
There are three types of testing: unit testing, integration testing and end-to-end testing."><meta itemprop=dateModified content="2021-08-31T21:11:29+02:00"><meta itemprop=wordCount content="2760"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Session 06: Testing Unikraft"><meta name=twitter:description content="00. The Concept of Testing In this session, we are going to explore the idea of validation by testing. Even though our main focus will be testing, we&rsquo;ll also tackle other validation methods such as fuzzing and symbolic execution. Before diving into how we can do testing on Unikraft, let&rsquo;s first focus on several key concepts that are used when talking about testing.
There are three types of testing: unit testing, integration testing and end-to-end testing."><link rel=preload href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css as=style><link href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Unikraft Summer of Code 2021</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Workshop</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center d-lg-none"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Workshop</a></li><ul><li class="collapse show" id=docs><a class="td-sidebar-link td-sidebar-link__page" id=m-docssessionsschedule href=/docs/sessions/schedule/>Schedule</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsoverviewpeople href=/docs/overview/people/>People</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions01-baby-steps href=/docs/sessions/01-baby-steps/>01. Baby Steps</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions02-behind-scenes href=/docs/sessions/02-behind-scenes/>02. Behind the Scenes</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions03-debugging href=/docs/sessions/03-debugging/>03. Debugging in Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions04-complex-applications href=/docs/sessions/04-complex-applications/>04. Complex Applications</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions05-contributing-to-unikraft href=/docs/sessions/05-contributing-to-unikraft/>05. Contributing to Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-docssessions06-testing-unikraft href=/docs/sessions/06-testing-unikraft/>06. Testing Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions07-syscall-shim href=/docs/sessions/07-syscall-shim/>07. Syscall Shim</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions08-basic-app-porting href=/docs/sessions/08-basic-app-porting/>08. Basic App Porting</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions09-advanced-app-porting href=/docs/sessions/09-advanced-app-porting/>09. Advanced App Porting</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions10-high-performance href=/docs/sessions/10-high-performance/>10. High Performance</a></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/unikraft/summer-of-code-2021/edit/master/content/en/docs/sessions/06-testing-unikraft/index.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/unikraft/summer-of-code-2021/new/master/content/en/docs/sessions/06-testing-unikraft/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/unikraft/summer-of-code-2021/issues/new?title=Session%2006:%20Testing%20Unikraft" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/unikraft/unikraft/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
<a id=print href=/docs/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><nav id=TableOfContents><ul><li><a href=#00-the-concept-of-testing>00. The Concept of Testing</a><ul><li><a href=#fuzzing>Fuzzing</a></li><li><a href=#symbolic-execution>Symbolic Execution</a></li></ul></li><li><a href=#01-existing-testing-frameworks>01. Existing Testing Frameworks</a><ul><li><a href=#linux-testing>Linux Testing</a></li><li><a href=#osv-testing>OSV Testing</a></li><li><a href=#user-space-testing>User Space Testing</a></li></ul></li><li><a href=#02-unikrafts-testing-framework>02. Unikraft&rsquo;s Testing Framework</a><ul><li><a href=#api-overview>API Overview</a></li></ul></li><li><a href=#03-the-design-behind-unikrafts-testing-framework>03. The Design behind Unikraft&rsquo;s Testing Framework</a><ul><li><a href=#how-tests-are-run>How Tests Are Run</a></li><li><a href=#key-functions-and-data-structures>Key Functions and Data Structures</a></li></ul></li><li><a href=#work-items>Work Items</a><ul><li><a href=#support-files>Support Files</a></li><li><a href=#01-tutorial-testing-a-simple-application>01. Tutorial: Testing a Simple Application</a></li><li><a href=#02-adding-a-new-test-suite>02. Adding a New Test Suite</a></li><li><a href=#03-tutorial-testing-vfscore>03. Tutorial: Testing vfscore</a></li><li><a href=#04-add-a-test-suite-for-nolibc>04. Add a Test Suite for nolibc</a></li><li><a href=#05-tutorial-running-google-test-on-unikraft>05. Tutorial: Running Google Test on Unikraft</a></li><li><a href=#06-tutorial-bonus-using-klee-for-symbolic-execution>06. Tutorial (Bonus): Using KLEE for Symbolic Execution</a></li></ul></li><li><a href=#further-reading>Further Reading</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Workshop</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/sessions/06-testing-unikraft/>06. Testing Unikraft</a></li></ol></nav><div class=td-content><h1>Session 06: Testing Unikraft</h1><h2 id=00-the-concept-of-testing>00. The Concept of Testing</h2><p>In this session, we are going to explore the idea of validation by testing.
Even though our main focus will be testing, we&rsquo;ll also tackle other validation methods such as fuzzing and symbolic execution.
Before diving into how we can do testing on Unikraft, let&rsquo;s first focus on several key concepts that are used when talking about testing.</p><p>There are three types of testing: unit testing, integration testing and end-to-end testing.
To better understand the difference between them, we will look over an example of a webshop.
If we&rsquo;re testing the whole workflow (creating an account, logging in, adding products to a cart, placing an order) we will call this <strong>end-to-end testing</strong>.
Our shop also has an analytics feature that allows us to see a couple of data points such as: how many times an article was clicked on, how much time did a user look at it and so on.
To make sure the inventory module and the analytics module are working correctly (a counter in the analytics module increases when we click on a product), we will be writing <strong>integration tests</strong>.
Our shop also has at least an image for every product which should maximize when we&rsquo;re clicking on it. To test this, we would write a <strong>unit test</strong>.</p><p>Running the test suite after each change is called <strong>regression testing</strong>. <strong>Automatic testing</strong> means that the tests are run and verified automatically. <strong>Automated regression testing</strong> is the best practice in software engineering.</p><p>One of the key metrics used in testing is <strong>code coverage</strong>.
This is used to measure the percentage of code that is executed during a test suite run.</p><p>There are three common types of coverage:</p><ul><li><strong>Statement coverage</strong>: the percentage of code statements that are run during the testing</li><li><strong>Branch coverage</strong>: the percentage of branches executed during the testing (e.g. if or while)</li><li><strong>Path coverage</strong>: the percentage of paths executed during the testing</li></ul><p>We&rsquo;ll now go briefly over two other validation techniques: fuzzing and symbolic execution.</p><h3 id=fuzzing>Fuzzing</h3><p><strong>Fuzzing</strong> or fuzz testing is an automated software testing technique that involves providing invalid, unexpected, or random data as inputs to a computer program.
The program is then monitored for exceptions such as crashes, failing built-in code assertions, or potential memory leaks.</p><p>The most popular OS fuzzers are <a href=https://github.com/IntelLabs/kAFL>kAFL</a> and <a href=https://github.com/google/syzkaller>syzkaller</a>, but research in this area is very active.</p><h3 id=symbolic-execution>Symbolic Execution</h3><p>As per Wikipedia, <strong>symbolic</strong> execution is a means of analyzing a program to determine what inputs cause each part of a program to execute.
An interpreter follows the program, assuming symbolic values for inputs rather than obtaining actual inputs as normal execution of the program would.
An example of a program being symbolically executed can be seen in the figure below:</p><p><img src=/docs/sessions/06-testing-unikraft/images/symbex.png alt="Symbolic execution"></p><p>The most popular symbolic execution engines are KLEE, S2E and angr.</p><h2 id=01-existing-testing-frameworks>01. Existing Testing Frameworks</h2><p>Nowadays, testing is usually done using a framework.
There is no single testing framework that can be used for everything but one has plenty of options to chose from.</p><h3 id=linux-testing>Linux Testing</h3><p>The main framework used by Linux for testing is KUnit.
The building block of KUnit are test cases, functions with the signature <code>void (*)(struct kunit *test)</code>. For example:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>example_add_test</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>kunit</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>test</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>{</span>
  <span style=color:#8f5902;font-style:italic>/* check if calling add(1,0) is equal to 1 */</span>
  <span style=color:#000>KUNIT_EXPECT_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>test</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>));</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>We can use macros such as <code>KUNIT_EXPECT_EQ</code> to verify results.</p><p>A set of test cases is called a <strong>test suite</strong>.
In the example below, we can see how one can add a test suite.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>kunit_case</span> <span style=color:#000>example_add_cases</span><span style=color:#000;font-weight:700>[]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000>KUNIT_CASE</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>example_add_test1</span><span style=color:#000;font-weight:700>),</span>
        <span style=color:#000>KUNIT_CASE</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>example_add_test2</span><span style=color:#000;font-weight:700>),</span>
        <span style=color:#000>KUNIT_CASE</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>example_add_test3</span><span style=color:#000;font-weight:700>),</span>
        <span style=color:#000;font-weight:700>{}</span>
<span style=color:#000;font-weight:700>};</span>

<span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>kunit_suite</span> <span style=color:#000>example_test_suite</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
        <span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;example&#34;</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#000;font-weight:700>.</span><span style=color:#000>init</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>example_test_init</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#000;font-weight:700>.</span><span style=color:#000>exit</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>example_test_exit</span><span style=color:#000;font-weight:700>,</span>
        <span style=color:#000;font-weight:700>.</span><span style=color:#000>test_cases</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>example_add_cases</span><span style=color:#000;font-weight:700>,</span>
<span style=color:#000;font-weight:700>};</span>
<span style=color:#000>kunit_test_suite</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>example_test_suite</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>The API is pretty intuitive and thoroughly detailed in the <a href=https://01.org/linuxgraphics/gfx-docs/drm/dev-tools/kunit/usage.html>official documentation</a>.</p><p>KUnit is not the only tool used for testing Linux, there are tens of tools used to test Linux at any time:</p><ul><li>Test suites: Linux Test Project (collection of tools), static code analyzers (Coverity, coccinelle, smatch, sparse), module tests (KUnit), fuzzing tools (Trinity, Syzkaller) and subsystem tests.</li><li>Automatic testing: kisskb, 0Day, kernelci, Kerneltests.</li></ul><p>In the figure below, we can see that as more and better tools were developed we saw an increase in reported vulnerabilities.
There was a peak in 2017, after which a steady decrease which may be caused by the amount of tools used to verify patches before being upstreamed.</p><p><img src=/docs/sessions/06-testing-unikraft/images/linux_vulnerabilities.png alt="arch selection menu"></p><h3 id=osv-testing>OSV Testing</h3><p>Let&rsquo;s see how another unikernel does the testing.
OSv uses a different approach.
They&rsquo;re using the Boost test framework alongside tests consisting of standalone simple applications.
For example, to test <code>read</code> they have the following <a href=https://github.com/cloudius-systems/osv/blob/master/tests/tst-read.cc>standalone app</a>, whereas for <a href=https://github.com/cloudius-systems/osv/blob/master/tests/tst-vfs.cc>testing thevfs</a>, they use boost.</p><h3 id=user-space-testing>User Space Testing</h3><p>Right now, there are a plethora of existing testing frameworks for different programming languages.
For example, Google Test is a testing framework for C++ whereas JUnit for Java.
Let&rsquo;s take a quick look at how Google Test works:</p><p>We have the following C++ code for the factorial in a function.cpp:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>Factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;=</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>*=</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000;font-weight:700>}</span>

  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>To create a test file, we&rsquo;ll create a new C++ source that includes <code>gtest/gtest.h</code>
We can now define the tests using the <code>TEST</code> macro. We named this test <code>Negative</code> and added it to the <code>FactorialTest</code>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#000>TEST</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>FactorialTest</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Negative</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
<span style=color:#000;font-weight:700>...</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Inside the test we can write C++ code as inside a function and use existing macros for adding test checks via macros such as <code>EXPECT_EQ</code>, <code>EXPECT_GT</code>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;gtest/gtest.h&#34;</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#000>TEST</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>FactorialTest</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Negative</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>{</span>
      <span style=color:#000>EXPECT_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>));</span>
      <span style=color:#000>EXPECT_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>));</span>
      <span style=color:#000>EXPECT_GT</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>In order to run the test we add a main function similar to the one below to the test file that we have just created:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#a40000>∗∗</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>testing</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>InitGoogleTest</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>);</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>RUN_ALL_TESTS</span><span style=color:#000;font-weight:700>();</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Easy?
This is not always the case, for example this <a href=https://github.com/google/googletest/blob/master/googletest/samples/sample9_unittest.cc>sample</a> shows a more advanced and nested test.</p><h2 id=02-unikrafts-testing-framework>02. Unikraft&rsquo;s Testing Framework</h2><p>Unikraft&rsquo;s testing framework, <code>uktest</code>, has been inspired by KUnit and provides a flexible testing API.</p><h3 id=api-overview>API Overview</h3><p>To use the API you have to include <code>uk/test.h</code>.
To register a testsuite, we simply call <code>uk_testsuite_register</code>.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#000>uk_testsuite_register</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>factorial_testsuite</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>NULL</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>We use the macro <code>UK_TESTCASE</code> to both declare a test suite and add a test case to it:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#000>UK_TESTCASE</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>testsuite_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>testcase1_name</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>UK_TEST_EXPECT_SNUM_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>some_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>UK_TESTCASE</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>testsuite_name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>testcase2_name</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>UK_TEST_EXPECT_SNUM_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>some_other_function</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>The entire API can be found <a href=https://github.com/unikraft/unikraft/blob/usoc21/lib/uktest/include/uk/test.h>here</a>.</p><h2 id=03-the-design-behind-unikrafts-testing-framework>03. The Design behind Unikraft&rsquo;s Testing Framework</h2><p>The key ideas that were followed when writing <code>uktest</code> are:</p><ul><li>Non-sophisticated. It should follow an existing framework (e.g. KUnit) in order to reuse the existing documentation and have a smaller learning curve</li><li>Ability to specify when to run the tests during the boot process</li><li>Written in C</li><li>Should not conflict with other unit test frameworks (e.g. the one used for testing libraries and apps such as Google Test)</li><li>BSD-compatible license</li><li>Have the ability to write tests as a whole file or as in-line tests above a method</li></ul><h3 id=how-tests-are-run>How Tests Are Run</h3><p>Unikraft boot process is centred around the idea of constructors.
Not to be confused with class constructors, Unikraft&rsquo;s constructors are simply functions registered in a special section inside the image and ran at boot time.
We use the <code>section</code> <a href=https://gcc.gnu.org/onlinedocs/gcc-3.2/gcc/Variable-Attributes.html>attribute</a> from GCC to tell the compiler to a specific section inside the binary, in our case <code>.uk_ctortab</code>.
Later at boot, we go through each value stored in the section and run it:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#000>uk_ctortab_foreach</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctorfn</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__init_array_start</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>__init_array_end</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!*</span><span style=color:#000>ctorfn</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>continue</span><span style=color:#000;font-weight:700>;</span>

  <span style=color:#000>uk_pr_debug</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Call constructor: %p()...</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>ctorfn</span><span style=color:#000;font-weight:700>);</span>
  <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>ctorfn</span><span style=color:#000;font-weight:700>)();</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>There are multiple such loops through the boot code found in <code>ukboot/boot.c</code>.
The testing framework simply registers the test function that needs to be called during the run.</p><h3 id=key-functions-and-data-structures>Key Functions and Data Structures</h3><p>The key structure used is <code>uk_testcase</code> defined as:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>uk_testcase</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#8f5902;font-style:italic>/* The name of the test case. */</span>
	<span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>;</span>
	<span style=color:#8f5902;font-style:italic>/* Pointer to the method  */</span>
	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>func</span><span style=color:#000;font-weight:700>)(</span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>uk_testcase</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>self</span><span style=color:#000;font-weight:700>);</span>
	<span style=color:#8f5902;font-style:italic>/* The number of failed assertions in this case. */</span>
	<span style=color:#204a87;font-weight:700>unsigned</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>failed_asserts</span><span style=color:#000;font-weight:700>;</span>
	<span style=color:#8f5902;font-style:italic>/* The number of assertions in this case. */</span>
	<span style=color:#204a87;font-weight:700>unsigned</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>total_asserts</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>};</span>
</code></pre></div><p>The macro that we&rsquo;re using to check conditions is <code>UK_TEST_ASSERT</code>.
It is a wrapper over <code>_uk_test_do_assert</code>:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span>
<span style=color:#000>_uk_test_do_assert</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>uk_testcase</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>esac</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>cond</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>fmt</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>...)</span>
<span style=color:#000;font-weight:700>{</span>
	<span style=color:#000;font-weight:700>...</span>
	<span style=color:#000>esac</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>total_asserts</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>;</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>cond</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>esac</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>failed_asserts</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>;</span>
	<span style=color:#000;font-weight:700>...</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Basically, what the function does is to increment the number of failed asserts if the condition is false.</p><p>We&rsquo;ve seen that <code>uk_testsuite_register</code> is used to register tests.
What this call boils down to is:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#8f5902;font-style:italic>#define uk_test_at_initcall_prio(suite, class, prio)			\
</span><span style=color:#8f5902;font-style:italic>	static int UK_TESTSUITE_FN(suite)(void)				\
</span><span style=color:#8f5902;font-style:italic>	{								\
</span><span style=color:#8f5902;font-style:italic>		uk_testsuite_add(&amp;suite);				\
</span><span style=color:#8f5902;font-style:italic>		uk_testsuite_run(&amp;suite);				\
</span><span style=color:#8f5902;font-style:italic>		return 0;						\
</span><span style=color:#8f5902;font-style:italic>	}								\
</span><span style=color:#8f5902;font-style:italic>	uk_initcall_class_prio(UK_TESTSUITE_FN(suite), class, prio)
</span></code></pre></div><p>We can see that <code>uk_initcall_class_prio</code> registers the newly defined function as a constructor to be called at a specific time during the boot process.
<code>uk_testsuite_add</code> simply adds the test suite to a linked listed of available test suites.
<code>uk_testsuite_run</code> simply iterates runs all the test cases in the test suite.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#204a87;font-weight:700>int</span>
<span style=color:#000>uk_testsuite_run</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>uk_testsuite</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>suite</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>{</span>
	<span style=color:#000;font-weight:700>...</span>
	<span style=color:#8f5902;font-style:italic>/* Iterate through all the registered test cases */</span>
	<span style=color:#000>uk_testsuite_for_each_case</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>suite</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>testcase</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>

    <span style=color:#8f5902;font-style:italic>/* Run the test case function
</span><span style=color:#8f5902;font-style:italic>		testcase-&gt;func(testcase);
</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic>		/* If one case fails, the whole suite fails. */</span>
		<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>testcase</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>failed_asserts</span> <span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span>
			<span style=color:#000>suite</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>failed_cases</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>;</span>
	<span style=color:#000;font-weight:700>}</span>
	<span style=color:#000;font-weight:700>...</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><h2 id=work-items>Work Items</h2><p>In this work session we will go over writing and running tests for Unikraft.
We will use <code>uktest</code> and <code>Google Test</code>.
Make sure you are on the <code>usoc21</code> branch on the core Unikraft repo and <code>staging</code> on all others.
<code>uktest</code> should be enabled from the Kconfig.</p><h3 id=support-files>Support Files</h3><p>Session support files are available <a href="https://drive.google.com/drive/folders/1PEDtvR5W-eMGQgbJusMcDPc6hS6ghYAl?usp=sharing">on Google Drive</a>.
You can use your own setup or the per cloned repos in <code>work.zip</code>.
Take a peek at the solutions in <code>sol.zip</code>.</p><h3 id=01-tutorial-testing-a-simple-application>01. Tutorial: Testing a Simple Application</h3><p>We will begin this session with a very simple example.
We can use the <code>app-helloworld</code> as a starting point.
In <code>main.c</code> remove all the existing code.
The next step is to include <code>uk/test.h</code> and define the factorial function:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;uk/test.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;=</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>*=</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000;font-weight:700>}</span>

  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>We are now ready to add a test suite with a test case:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#000>UK_TESTCASE</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>factorial_testsuite</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>factorial_test_positive</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>{</span>
       <span style=color:#000>UK_TEST_EXPECT_SNUM_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>uk_testsuite_register</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>factorial_testsuite</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>NULL</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>When we run this application, we should see the following output.</p><pre><code>test: factorial_testsuite-&gt;factorial_test_positive
    :	expected `factorial(2)` to be 2 but was 2 ....................................... [ PASSED ]
</code></pre><p>Throughout this session we will extend this simple app that we have just written.</p><h3 id=02-adding-a-new-test-suite>02. Adding a New Test Suite</h3><p>For this task, you will have to modify the existing factorial application by adding a new function that computes if a number is prime.
Add a new testsuite for this function.</p><h3 id=03-tutorial-testing-vfscore>03. Tutorial: Testing vfscore</h3><p>We begin by adding a new file for the tests called <code>test_stat.c</code> in a newly created folder <code>tests</code> in the <code>vfscore</code> internal library:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Makefile data-lang=Makefile><span style=color:#000>LIBVFSCORE_SRCS-$(CONFIG_LIBVFSCORE_TEST_STAT)</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#4e9a06>\
</span><span style=color:#4e9a06></span>    <span style=color:#204a87;font-weight:700>$(</span>LIBVFSCORE_BASE<span style=color:#204a87;font-weight:700>)</span>/tests/test_stat.c
</code></pre></div><p>We then add the menuconfig option in the <code>if LIBVFSCORE</code> block:</p><pre><code class=language-KConfig data-lang=KConfig>menuconfig LIBVFSCORE_TEST
    bool &quot;Test vfscore&quot;
    select LIBVFSCORE_TEST_STAT if LIBUKTEST_ALL
    default n

if LIBVFSCORE_TEST

config LIBVFSCORE_TEST_STAT
    bool &quot;test: stat()&quot;
    select LIBRAMFS
    default n

endif
</code></pre><p>And finally add a new testsuite with a test case.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;uk/test.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;fcntl.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;errno.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;unistd.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;sys/stat.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;sys/mount.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#204a87;font-weight:700>typedef</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000>vfscore_stat</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>rc</span><span style=color:#000;font-weight:700>;</span>
    <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>errcode</span><span style=color:#000;font-weight:700>;</span>
    <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>filename</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span> <span style=color:#000>vfscore_stat_t</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#204a87;font-weight:700>static</span> <span style=color:#000>vfscore_stat_t</span> <span style=color:#000>test_stats</span> <span style=color:#000;font-weight:700>[]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000;font-weight:700>{</span> <span style=color:#000;font-weight:700>.</span><span style=color:#000>rc</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span>    <span style=color:#000;font-weight:700>.</span><span style=color:#000>errcode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span>        <span style=color:#000;font-weight:700>.</span><span style=color:#000>filename</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;/foo/file.txt&#34;</span> <span style=color:#000;font-weight:700>},</span>
    <span style=color:#000;font-weight:700>{</span> <span style=color:#000;font-weight:700>.</span><span style=color:#000>rc</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span>    <span style=color:#000;font-weight:700>.</span><span style=color:#000>errcode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>EINVAL</span><span style=color:#000;font-weight:700>,</span>    <span style=color:#000;font-weight:700>.</span><span style=color:#000>filename</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>NULL</span> <span style=color:#000;font-weight:700>},</span>
<span style=color:#000;font-weight:700>};</span>

<span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>fd</span><span style=color:#000;font-weight:700>;</span>

<span style=color:#000>UK_TESTCASE</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>vfscore_stat_testsuite</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>vfscore_test_newfile</span><span style=color:#000;font-weight:700>)</span>
<span style=color:#000;font-weight:700>{</span>
    <span style=color:#8f5902;font-style:italic>/* First check if mount works all right */</span>
    <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>ret</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mount</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;/&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;ramfs&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>NULL</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000>UK_TEST_EXPECT_SNUM_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ret</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#000>ret</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mkdir</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/foo&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>S_IRWXU</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000>UK_TEST_EXPECT_SNUM_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ret</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#000>fd</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/foo/file.txt&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>O_WRONLY</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>O_CREAT</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>S_IRWXU</span><span style=color:#000;font-weight:700>);</span>
    <span style=color:#000>UK_TEST_EXPECT_SNUM_GT</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fd</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>);</span>

    <span style=color:#000>UK_TEST_EXPECT_SNUM_EQ</span><span style=color:#000;font-weight:700>(</span>
        <span style=color:#000>write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fd</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;hello</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>sizeof</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;hello</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)),</span>
        <span style=color:#204a87;font-weight:700>sizeof</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;hello</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#000;font-weight:700>);</span>
    <span style=color:#000>fsync</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fd</span><span style=color:#000;font-weight:700>);</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic>/* Register the test suite */</span>
<span style=color:#000>uk_testsuite_register</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>vfscore_stat_testsuite</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87>NULL</span><span style=color:#000;font-weight:700>);</span>
</code></pre></div><p>We will be using a simple app without any main function to run the testsuite, the output should be similar with:</p><pre><code>test: vfscore_stat_testsuite-&gt;vfscore_test_newfile
    :	expected `ret` to be 0 but was 0 ................................................ [ PASSED ]
    :	expected `ret` to be 0 but was 0 ................................................ [ PASSED ]
    :	expected `fd` to be greater than 2 but was 3 .................................... [ PASSED ]
    :	expected `write(fd, &quot;hello\n&quot;, sizeof(&quot;hello\n&quot;))` to be 7 but was 7 ............ [ PASSED ]
</code></pre><h3 id=04-add-a-test-suite-for-nolibc>04. Add a Test Suite for nolibc</h3><p>Add a new test suite for nolibc with four test cases in it.
You can use any POSIX function from nolibc for this task.
Feel free to look over the <a href=https://github.com/lancs-net/unikraft/blob/nderjung/uktest/lib/uktest/include/uk/test.h>documentation</a> to write more complex tests.</p><h3 id=05-tutorial-running-google-test-on-unikraft>05. Tutorial: Running Google Test on Unikraft</h3><p>For this tutorial, we will use Google Test under Unikraft.
Aside from <code>lib-googletest</code>, we&rsquo;ll also need to have <code>libcxx</code>, <code>libcxxabi</code>, <code>libunwind</code>, <code>compiler-rt</code> and <code>newlib</code> because we&rsquo;re testing C++ code.</p><p>The second step is to enable the Google Test library and its config option <code>Build google test with main</code>.</p><p>We can now add a new cpp file, <code>main.cpp</code>.
Make sure that the files end in <code>.cpp</code> and not <code>.c</code>, otherwise you&rsquo;ll get lots of errors.
In the source file we&rsquo;ll include <code>gtest/gtest.h</code>
We will now be able to add our factorial function and test it.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>Factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;=</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>*=</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000;font-weight:700>}</span>

  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#000>TEST</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>FactorialTest</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Negative</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#000>EXPECT_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>));</span>
  <span style=color:#000>EXPECT_EQ</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>));</span>
  <span style=color:#000>EXPECT_GT</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Factorial</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>),</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span>

<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>If we run our unikernel, we should see the following output:</p><pre><code>[==========] Running 1 test from 1 test case.
[----------] Global test environment set-up.
[----------] 1 test from FactorialTest
[ RUN      ] FactorialTest.Negative
[       OK ] FactorialTest.Negative (0 ms)
[----------] 1 test from FactorialTest (0 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test case ran. (0 ms total)
[  PASSED  ] 1 test.
</code></pre><p>We can see that in this case, the tests are being run after the main call, not before!</p><h3 id=06-tutorial-bonus-using-klee-for-symbolic-execution>06. Tutorial (Bonus): Using KLEE for Symbolic Execution</h3><p>One of the most popular symbolic execution engine is <a href=https://klee.github.io/>KLEE</a>.
For convenience, we&rsquo;ll be using Docker.</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Bash data-lang=Bash>docker pull klee/klee:2.1
docker run --rm -ti --ulimit<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;stack=-1:-1&#39;</span> klee/klee:2.1
</code></pre></div><p>Let&rsquo;s look over this regular expression program, can you spot any bugs?
We&rsquo;ll create a file <code>ex.c</code> with this code:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C++ data-lang=C++><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;stdio.h&gt;</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>matchhere</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000;font-weight:700>,</span><span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000;font-weight:700>);</span>

<span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>matchstar</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>c</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>text</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>do</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>matchhere</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>text</span><span style=color:#000;font-weight:700>))</span>
      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>while</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>text</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#39;\0&#39;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>text</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>c</span><span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;.&#39;</span><span style=color:#000;font-weight:700>));</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>matchhere</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>text</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;\0&#39;</span><span style=color:#000;font-weight:700>)</span>
     <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;*&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>matchstar</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>re</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>text</span><span style=color:#000;font-weight:700>);</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;$&#39;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>re</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>==</span><span style=color:#4e9a06>&#39;\0&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>text</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;\0&#39;</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>text</span><span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#4e9a06>&#39;\0&#39;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>==</span><span style=color:#4e9a06>&#39;.&#39;</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>re</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span><span style=color:#ce5c00;font-weight:700>==*</span><span style=color:#000>text</span><span style=color:#000;font-weight:700>))</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>matchhere</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>text</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>match</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>text</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;^&#39;</span><span style=color:#000;font-weight:700>)</span>
    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>matchhere</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>text</span><span style=color:#000;font-weight:700>);</span>
  <span style=color:#204a87;font-weight:700>do</span> <span style=color:#000;font-weight:700>{</span>
    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>matchhere</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>text</span><span style=color:#000;font-weight:700>))</span>
      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>while</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>text</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#39;\0&#39;</span><span style=color:#000;font-weight:700>);</span>
  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic>#define SIZE 7
</span><span style=color:#8f5902;font-style:italic></span>
<span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span> <span style=color:#ce5c00;font-weight:700>**</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
  <span style=color:#204a87;font-weight:700>char</span> <span style=color:#000>re</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>SIZE</span><span style=color:#000;font-weight:700>];</span>

  <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>count</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>read</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>re</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>SIZE</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
  <span style=color:#8f5902;font-style:italic>//klee_make_symbolic(re, sizeof re, &#34;re&#34;);
</span><span style=color:#8f5902;font-style:italic></span>
  <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>m</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>match</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>re</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;hello&#34;</span><span style=color:#000;font-weight:700>);</span>
  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>m</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000>printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Match</span><span style=color:#4e9a06>\n</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>re</span><span style=color:#000;font-weight:700>);</span>

  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><p>Now, let&rsquo;s run this program symbolically.
To do this, we&rsquo;ll uncomment the <code>klee_make_symbol</code> line, and comment the line with <code>read</code> and <code>printf</code>.
We&rsquo;ll compile the program with <code>clang</code> this time:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Bash data-lang=Bash>clang -c -g -emit-llvm  ex.c
</code></pre></div><p>And run it with KLEE:</p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Bash data-lang=Bash>klee ex.bc
</code></pre></div><p>We&rsquo;ll see the following output:</p><pre><code>KLEE: output directory is &quot;/home/klee/klee-out-4&quot;
KLEE: Using STP solver backend
KLEE: ERROR: ex1.c:13: memory error: out of bound pointer
KLEE: NOTE: now ignoring this error at this location
KLEE: ERROR: ex1.c:15: memory error: out of bound pointer
KLEE: NOTE: now ignoring this error at this location

KLEE: done: total instructions = 5314314
KLEE: done: completed paths = 7692
KLEE: done: generated tests = 6804
</code></pre><p>This tells us that KLEE has found two memory errors.
It also gives us some info about the number of paths and instructions executed.
After the run, a folder <code>klee-last</code> has been generated that contains all the test cases.
We want to find the ones that generated memory errors:</p><pre><code>klee@affd7769bb39:~/klee-last$ ls | grep err
test000018.ptr.err
test000020.ptr.err
</code></pre><p>We look at testcase 18:</p><pre><code>klee@affd7769bb39:~/klee-last$ ktest-tool test000018.ktest
ktest file : 'test000018.ktest'
args       : ['ex1.bc']
num objects: 1
object 0: name: 're'
object 0: size: 7
object 0: data: b'^\x01*\x01*\x01*'
object 0: hex : 0x5e012a012a012a
object 0: text: ^.*.*.*
</code></pre><p>This is just a quick example of the power of symbolic execution, but it comes with one great problem: path explosion.
When we have more complicated programs that have unbounded loops, the number of paths grows exponentially and thus symbolic execution is not viable anymore.</p><h2 id=further-reading>Further Reading</h2><ul><li><a href=https://ocw.mit.edu/ans7870/6/6.005/s16/classes/03-testing/index.html#automated_testing_and_regression_testing>6.005 Reading 3: Test</a></li><li><a href=https://blog.cloudflare.com/a-gentle-introduction-to-linux-kernel-fuzzing/>A gentle introduction to Linux Kernel fuzzing</a></li><li><a href=https://adalogics.com/blog/symbolic-execution-with-klee>Symbolic execution with KLEE</a></li><li><a href=https://www.kernel.org/doc/html/latest/dev-tools/kunit/usage.html>Using KUnit</a></li></ul><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/unikraft/summer-of-code-2021/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/unikraft/summer-of-code-2021/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified August 31, 2021: <a href=https://github.com/unikraft/summer-of-code-2021/commit/9c435c27b7aa91aeb6d3f8ce990d83828c8d5fbb>Fix typos, missing stops, and section numbering (9c435c2)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel="noopener noreferrer" href=https://bit.ly/UnikraftDiscord><i class="fab fa-discord"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/UnikraftSDK><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/unikraft/unikraft><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel="noopener noreferrer" href=https://linkedin.com/company/unikraft-sdk><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 Unikraft and Open-Source Contributors. All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>