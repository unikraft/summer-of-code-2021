<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Session 04: Complex Applications | Unikraft Summer of Code 2021</title><meta property="og:title" content="Session 04: Complex Applications"><meta property="og:description" content="Reminders Print system This print system in implemented in lib/ukdebug and can be activated using make menuconfig (Library Configuration -> ukdebug: Debugging and Tracing).
We have two types of messages:
 Kernel messages  Information(uk_pr_info) Warnings(uk_pr_warn) Errors(uk_pr_err) Critical Messages(uk_pr_crit)   Debug messages(uk_pr_debug)  Assertions We can use assertions to check if the system is in a defined and stable state. Can be compiled-in or compiled-out and it can be activated from Library Configuration -> ukdebug: Debugging and Tracing -> Enable assertions."><meta property="og:type" content="article"><meta property="og:url" content="/docs/sessions/04-complex-applications/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2021-08-27T15:16:18+03:00"><meta property="og:site_name" content="Unikraft Summer of Code 2021"><meta itemprop=name content="Session 04: Complex Applications"><meta itemprop=description content="Reminders Print system This print system in implemented in lib/ukdebug and can be activated using make menuconfig (Library Configuration -> ukdebug: Debugging and Tracing).
We have two types of messages:
 Kernel messages  Information(uk_pr_info) Warnings(uk_pr_warn) Errors(uk_pr_err) Critical Messages(uk_pr_crit)   Debug messages(uk_pr_debug)  Assertions We can use assertions to check if the system is in a defined and stable state. Can be compiled-in or compiled-out and it can be activated from Library Configuration -> ukdebug: Debugging and Tracing -> Enable assertions."><meta itemprop=dateModified content="2021-08-27T15:16:18+03:00"><meta itemprop=wordCount content="2923"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Session 04: Complex Applications"><meta name=twitter:description content="Reminders Print system This print system in implemented in lib/ukdebug and can be activated using make menuconfig (Library Configuration -> ukdebug: Debugging and Tracing).
We have two types of messages:
 Kernel messages  Information(uk_pr_info) Warnings(uk_pr_warn) Errors(uk_pr_err) Critical Messages(uk_pr_crit)   Debug messages(uk_pr_debug)  Assertions We can use assertions to check if the system is in a defined and stable state. Can be compiled-in or compiled-out and it can be activated from Library Configuration -> ukdebug: Debugging and Tracing -> Enable assertions."><link rel=preload href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css as=style><link href=/scss/main.min.1858cefeac68bf8654b05bceedf9634026955a53eb72683390eb36eb9c7a0dfc.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Unikraft Summer of Code 2021</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Workshop</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center d-lg-none"><input type=search class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/docs/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Workshop</a></li><ul><li class="collapse show" id=docs><a class="td-sidebar-link td-sidebar-link__page" id=m-docssessionsschedule href=/docs/sessions/schedule/>Schedule</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docsoverviewpeople href=/docs/overview/people/>People</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions01-baby-steps href=/docs/sessions/01-baby-steps/>01. Baby Steps</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions02-behind-scenes href=/docs/sessions/02-behind-scenes/>02. Behind the Scenes</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions03-benchmarking-and-debugging href=/docs/sessions/03-benchmarking-and-debugging/>03. Benchmarking and Debugging</a>
<a class="td-sidebar-link td-sidebar-link__page active" id=m-docssessions04-complex-applications href=/docs/sessions/04-complex-applications/>04. Complex Applications</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions05-contributing-to-unikraft href=/docs/sessions/05-contributing-to-unikraft/>05. Contributing to Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions06-testing-unikraft href=/docs/sessions/06-testing-unikraft/>06. Testing Unikraft</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions07-syscall-shim href=/docs/sessions/07-syscall-shim/>07. Syscall Shim</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions08-basic-app-porting href=/docs/sessions/08-basic-app-porting/>08. Basic App Porting</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions09-advanced-app-porting href=/docs/sessions/09-advanced-app-porting/>09. Advanced App Porting</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-docssessions10-high-performance href=/docs/sessions/10-high-performance/>10. High Performance</a></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/unikraft/summer-of-code-2021/edit/master/content/en/docs/sessions/04-complex-applications/index.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/unikraft/summer-of-code-2021/new/master/content/en/docs/sessions/04-complex-applications/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/unikraft/summer-of-code-2021/issues/new?title=Session%2004:%20Complex%20Applications" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/unikraft/unikraft/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a>
<a id=print href=/docs/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><nav id=TableOfContents><ul><li><a href=#reminders>Reminders</a><ul><li><a href=#print-system>Print system</a></li><li><a href=#assertions>Assertions</a></li><li><a href=#gdb>GDB</a></li><li><a href=#tracepoints>Tracepoints</a></li></ul></li><li><a href=#work-items>Work Items</a><ul><li><a href=#support-files>Support Files</a></li><li><a href=#00-qemu-wrapper>00. Qemu Wrapper</a></li><li><a href=#01-sqlite-tutorial>01. SQLite (Tutorial)</a></li><li><a href=#02-sqlite-new-filesystem-tutorial>02. SQLite New Filesystem (Tutorial)</a></li><li><a href=#03-redis-tutorial>03. Redis (Tutorial)</a></li><li><a href=#04-redis-static-ip-address>04. Redis Static IP Address</a></li><li><a href=#05-redis-benchmarking-tutorial>05. Redis Benchmarking (Tutorial)</a></li><li><a href=#06-nginx>06. Nginx</a></li><li><a href=#07-nginx-benchmarking-tutorial>07. Nginx Benchmarking (Tutorial)</a></li><li><a href=#08-give-us-feedback>08. Give Us Feedback</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Workshop</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/sessions/04-complex-applications/>04. Complex Applications</a></li></ol></nav><div class=td-content><h1>Session 04: Complex Applications</h1><h2 id=reminders>Reminders</h2><h3 id=print-system>Print system</h3><p>This print system in implemented in <code>lib/ukdebug</code> and can be activated using <code>make menuconfig</code> (<code>Library Configuration -> ukdebug: Debugging and Tracing</code>).</p><p>We have two types of messages:</p><ul><li><strong>Kernel messages</strong><ul><li><strong>Information</strong>(<code>uk_pr_info</code>)</li><li><strong>Warnings</strong>(<code>uk_pr_warn</code>)</li><li><strong>Errors</strong>(<code>uk_pr_err</code>)</li><li><strong>Critical Messages</strong>(<code>uk_pr_crit</code>)</li></ul></li><li><strong>Debug messages</strong>(<code>uk_pr_debug</code>)</li></ul><h3 id=assertions>Assertions</h3><p>We can use assertions to check if the system is in a defined and stable state.
Can be compiled-in or compiled-out and it can be activated from <code>Library Configuration -> ukdebug: Debugging and Tracing -> Enable assertions</code>.</p><p>The macros used can be:</p><ul><li><code>UK_ASSERT</code> (condition)</li><li><code>UK_BUGON</code> (negative condition)</li><li><code>UK_CTASSERT</code> (condition)(used for compile-time assertions)</li></ul><h3 id=gdb>GDB</h3><p>To use GDB we need the symbols from the <code>gdb</code> file generated at build time.
For this we need to set <code>Debug information level</code> to <code>Level 3</code> from <code>make menuconfig</code> (<code>Build Options -> Debug information level -> Level 3</code>).</p><h4 id=linux>Linux</h4><p>For the Linux user space target (<code>linuxu</code>) simply point GDB to the resulting debug image:</p><pre><code>$ gdb path_to_unikraft_gdb_image
</code></pre><h4 id=kvm>KVM</h4><p>For KVM we need to go through few steps:</p><ol><li><p>Run guest in paused state</p><p>Using <strong>qemu</strong>:</p><pre><code>$ qemu-guest -P -g 1234 -k path_to_unikraft_gdb_image
</code></pre><p>Using <strong>kraft</strong>:</p><pre><code>$ kraft run -d -g 1234 -P
</code></pre></li><li><p>Attach debugger</p><pre><code>$ gdb --eval-command=&quot;target remote :1234&quot; path_to_unikraft_gdb_image
</code></pre></li><li><p>Disconnect GDB</p><pre><code>disconnect
</code></pre></li><li><p>Set GDB&rsquo;s machine architecture to x86_64</p><pre><code>$ set arch i386:x86-64:intel
</code></pre></li><li><p>Re-connect</p><pre><code>tar remote localhost:1234
</code></pre></li></ol><h3 id=tracepoints>Tracepoints</h3><p>Tracepoints are provided by <code>lib/ukdebug</code>.
To enable Unikraft to collect trace data, enable the option <code>CONFIG_LIBUKDEBUG_TRACEPOINTS</code> in your configuration (via <code>make menuconfig</code> under <code>Library Configuration -> ukdebug -> Enable tracepoints</code>).</p><h4 id=instrumenting>Instrumenting</h4><p>Instrumenting your code with tracepoints is done by two steps:</p><ul><li>Define and register a tracepoint handler with the <code>UK_TRACEPOINT()</code> macro.</li><li>Place calls to the generated handler at those places in your code where your want to trace an event.</li></ul><h4 id=reading-traces>Reading traces</h4><p>Unikraft is storing trace data to an internal buffer that resides in the guest&rsquo;s main memory.
To access that data you need to configure the GDB and add <code>source /path/to/your/build/uk-gdb.py</code> to <code>~/.gdbinit</code></p><p>Commands available in GDB:</p><table><thead><tr><th>Commands</th><th>Deion</th></tr></thead><tbody><tr><td>uk trace</td><td>show tracepoints in GDB</td></tr><tr><td>uk trace save <code>&lt;file></code></td><td>save tracepoints to file</td></tr></tbody></table><p>Any saved trace file can be later processed with the <code>trace.py</code> .</p><pre><code>$ support/s/uk_trace/trace.py list &lt;file&gt;
</code></pre><h2 id=work-items>Work Items</h2><p>In this session, we are going to run some real-world applications on top of Unikraft.</p><h3 id=support-files>Support Files</h3><p>Session support files are available <a href=https://github.com/unikraft/summer-of-code-2021>in the repository</a>.
If you already cloned the repository, update it and enter the session directory:</p><pre><code>$ cd path/to/repository/clone

$ git pull --rebase

$ cd content/en/docs/sessions/04-complex-applications/

$ ls -F
images/  index.md  sol/  work/
</code></pre><p>If you haven&rsquo;t cloned the repository yet, clone it and enter the session directory:</p><pre><code>$ git clone https://github.com/unikraft/summer-of-code-2021

$ cd summer-of-code-2021/content/en/docs/sessions/04-complex-applications/

$ ls -F
images/  index.md  sol/  work/
</code></pre><h3 id=00-qemu-wrapper>00. Qemu Wrapper</h3><p>As we saw during the other sessions, <a href=https://github.com/unikraft/kraft/blob/staging/scripts/qemu-guest>qemu-guest</a> is a wrapper script over the <code>qemu-system-x86_64</code> executable, to make the use of binary less painful.
In the following session, it will be very handy to use it.
To see the options for this wrapper you can use <code>qemu-guest -h</code>.</p><p>It is possible to run a lot of complex applications on Unikraft.
In this session we analyze 3 of them:</p><ul><li>Sqlite</li><li>Redis</li><li>Nginx</li></ul><h3 id=01-sqlite-tutorial>01. SQLite (Tutorial)</h3><p>The goal of this tutorial is to get you to set up and run SQLite on top of Unikraft.
Find the support files in the <code>work/01-set-up-and-run-sqlite/</code> folder of the session directory.</p><p><a href=https://www.sqlite.org/index.html>SQLite</a> is a C library that implements an encapsulated SQL database engine that does not require any setting or administration.
It is one of the most popular in the world and is different from other SQL database engines because it is simple to administer, use, maintain, and test.
Thanks to these features, SQLite is a fast, secure, and most crucial simple application.</p><p>The SQLite application is formed by a ported external library that depends on two other libraries that are also ported for Unikraft: <a href=https://github.com/unikraft/lib-pthread-embedded>pthread-embedded</a> and <a href=https://github.com/unikraft/lib-newlib>newlib</a>.
To successfully compile and run the SQLite application for the KVM platform and x86-64 architecture, we follow the steps below.</p><h4 id=setup>Setup</h4><p>First, we make sure we have the directory structure to store the local clones of Unikraft, library and application repositories.
The structure should be:</p><pre><code>workdir
|-- unikraft/
|-- libs/
`-- apps/
</code></pre><p>We clone the <a href=https://github.com/unikraft/lib-sqlite>lib-sqlite</a> repository in the <code>libs/</code> folder.
The libraries on which <code>lib-sqlite</code> depends (<a href=https://github.com/unikraft/lib-newlib>pthread-embedded</a> and <a href=https://github.com/unikraft/lib-pthread-embedded>newlib</a>) are also to be cloned in the <code>libs/</code> folder.</p><p>We clone the <a href=https://github.com/unikraft/app-sqlite/>app-sqlite</a> repository in the <code>apps/</code> folder.
In this directory, we need to create two files:</p><ul><li><code>Makefile</code>: containing rules for building the application as well as specifying the libraries that the application needs</li><li><code>Makefile.uk</code>: used to define variables needed to compile the application or to add application-specific flags</li></ul><p>Also, in the <code>Makefile</code>, the order in which the libraries are mentioned in the <code>LIBS</code> variable is important to avoid the occurrence of compilation errors.</p><pre><code>UK_ROOT ?= $(PWD)/../../unikraft
UK_LIBS ?= $(PWD)/../../libs
LIBS := $(UK_LIBS)/lib-pthread-embedded:$(UK_LIBS)/lib-newlib:$(UK_LIBS)/lib-sqlite

all:
	@$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS)

$(MAKECMDGOALS):
	@$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS) $(MAKECMDGOALS)
</code></pre><h4 id=configure>Configure</h4><p>We configure the application by running:</p><pre><code>$ make menuconfig
</code></pre><p>We select the SQLite library from the configuration menu, <code>Library Configuration</code> section.
For starters, we select the option to generate the main source file used to run the application.</p><p>To import or export databases or CSV/SQL files, the SQLite application needs to configure a filesystem.
The filesystem we use is 9pfs.
Hence, in the <code>Library Configuration</code> section, we select the <code>9pfs</code> filesystem within the <code>vfscore</code> library options.</p><p>Make sure, that both options <code>Virtio PCI device support</code> and <code>Virtio 9P device</code> are selected.
Those can be found in: <code>Platform Configuration</code> -> <code>KVM guest</code> -> <code>Virtio</code>.</p><p><img src=/docs/sessions/04-complex-applications/images/9pfs_options.png alt="9pfs options"></p><h4 id=build>Build</h4><p>We build the application by running:</p><pre><code>$ make
</code></pre><h4 id=test>Test</h4><p>For testing we can use the following SQLite script, which inserts ten values into a table:</p><pre><code>CREATE TABLE tab (d1 int, d2 text);
INSERT INTO tab VALUES (random(), cast(random() as text)),
(random(), cast(random() as text)),
(random(), cast(random() as text)),
(random(), cast(random() as text)),
(random(), cast(random() as text)),
(random(), cast(random() as text)),
(random(), cast(random() as text)),
(random(), cast(random() as text)),
(random(), cast(random() as text)),
(random(), cast(random() as text));
</code></pre><p>Up next, create a folder in the application folder called <code>sqlite_files</code> and write the above script into a file.
When you run the application, you can specify the path of the newly created folder to the <code>qemu-guest</code> as following:</p><pre><code>$ ./qemu-guest -k ./build/app-sqlite_kvm-x86_64 \
               -e ./sqlite_files \
               -m 500
</code></pre><p>The SQLite start command has several parameters:</p><ul><li><code>k</code> indicates the executable resulting from the build of the entire system together with the <code>SQLite application</code></li><li><code>e</code> indicates the path to the shared directory where the Unikraft filesystem will be mounted</li><li><code>m</code> indicates the memory allocated to the application</li></ul><p>To load the SQLite script, we use the following command <code>.read &lt;sqlite_script_name.sql></code>.
And in the end, we run <code>select * from tab</code> to see the contents of the table.</p><p>If everything runs as expected, then we&rsquo;ll see the following output:</p><pre><code>SeaBIOS (version 1.10.2-1ubuntu1)
Booting from ROM...
Powered by
o.   .o       _ _               __ _
Oo   Oo  ___ (_) | __ __  __ _ ' _) :_
oO   oO ' _ `| | |/ /  _)' _` | |_|  _)
oOo oOO| | | | |   (| | | (_) |  _) :_
 OoOoO ._, ._:_:_,\_._,  .__,_:_, \___)
                   Tethys 0.5.0~825b115
SQLite version 3.30.1 2019-10-10 20:19:45
Enter &quot;.help&quot; for usage hints.
sqlite&gt; .read script.sql
sqlite&gt; select * from tab;
-4482895989777805454|-110319092326802521
1731384004930241734|4521105937488475129
394829130239418471|-5931220326625632549
4715172377251814631|3421393665393635031
2633802986882468389|174376437407985264
-1691186051150364618|3056262814461654943
-4054754806183404125|-2391909815601847844
-4437812378917371546|-6267837926735068846
8830824471222267926|7672933566995619644
4185269687730257244|-3477150175417807640
sqlite&gt;
</code></pre><h3 id=02-sqlite-new-filesystem-tutorial>02. SQLite New Filesystem (Tutorial)</h3><p>In the previous work item, we have chosen to use 9PFS as the filesystem.
For this work item, we want to change the filesystem to RamFS and load the SQLlite script as we have done in the previous work item.
Find the support files in the <code>work/02-change-filesystem-sqlite/</code> folder of the session directory.</p><p>First, we need to change the filesystem to InitRD.
We can obtain that by using the command <code>make menuconfig</code> and from the <code>vfscore: Configuration</code> option, we select the default root filesystem as <code>InitRD</code>.</p><p><img src=/docs/sessions/04-complex-applications/images/filesystems.png alt="filesystems menu"></p><p>The InitRD filesystem can load only <a href="https://www.ibm.com/docs/en/zos/2.2.0?topic=formats-cpio-format-cpio-archives">cpio archives</a>, so to load our SQLite script into RamFS filesystem, we need to create a cpio out of it.
This can be achieved the following way: Create a folder, move the SQLite script in it, and <code>cd </code>in it.
After that we run the following command:</p><pre><code>$ find -type f | bsdcpio -o --format newc &gt; ../archive.cpio
</code></pre><p>We&rsquo;ll obtain an cpio archive called <code>archive.cpio</code> in the parent directory.</p><p>Next we run the following qemu command to run the instance:</p><pre><code>$ ./qemu-guest -k build/app-sqlite_kvm-x86_64 -m 100 -i archive.cpio
</code></pre><p>If everything runs as expected, then we&rsquo;ll see the following output:</p><pre><code>SeaBIOS (version 1.10.2-1ubuntu1)
Booting from ROM...
Powered by
o.   .o       _ _               __ _
Oo   Oo  ___ (_) | __ __  __ _ ' _) :_
oO   oO ' _ `| | |/ /  _)' _` | |_|  _)
oOo oOO| | | | |   (| | | (_) |  _) :_
 OoOoO ._, ._:_:_,\_._,  .__,_:_, \___)
                   Tethys 0.5.0~825b115
SQLite version 3.30.1 2019-10-10 20:19:45
Enter &quot;.help&quot; for usage hints.
sqlite&gt; .read script.sql
sqlite&gt; select * from tab;
-4482895989777805454|-110319092326802521
1731384004930241734|4521105937488475129
394829130239418471|-5931220326625632549
4715172377251814631|3421393665393635031
2633802986882468389|174376437407985264
-1691186051150364618|3056262814461654943
-4054754806183404125|-2391909815601847844
-4437812378917371546|-6267837926735068846
8830824471222267926|7672933566995619644
4185269687730257244|-3477150175417807640
sqlite&gt;
</code></pre><h3 id=03-redis-tutorial>03. Redis (Tutorial)</h3><p>The goal of this tutorial is to get you to set up and run Redis on top of Unikraft.
Find the support files in the <code>work/03-set-up-and-run-redis/</code> folder of the session directory.</p><p><a href=https://redis.io/topics/introduction>Redis</a> is one of the most popular key-value databases, with a design that facilitates the fast writing and reading of data from memory as well as the storage of data on disk to be able to reconstruct the state of data in memory in case of a system restart.
Unlike other data storage systems, Redis supports different types of data structures such as lists, maps, strings, sets, bitmaps, streams.</p><p>The Redis application is formed by a ported external library that depends on other ported libraries for Unikraft (<a href=https://github.com/unikraft/lib-pthread-embedded>pthread-embedded</a>, <a href=https://github.com/unikraft/lib-newlib>newlib</a>, <a href=https://github.com/unikraft/lib-lwip>lwip-network</a> library).
To successfully compile and run the Redis application for the KVM platform and x86-64 architecture, we follow the steps below.</p><h4 id=setup-1>Setup</h4><p>As above, we make sure we have the directory structure to store the local clones of Unikraft, library and application repositories.
The structure should be:</p><pre><code>workdir
|-- unikraft/
|-- libs/
`-- apps/
</code></pre><p>We clone the <a href=https://github.com/unikraft/lib-redis>lib-redis</a> repository in the <code>libs/</code> folder.
We alsoe clonethe library repositories which <a href=https://github.com/unikraft/lib-redis>lib-redis</a> depends on ([pthread-embedded](<a href=https://github.com/unikraft/lib-pthread-embedded>pthread-embedded</a>, <a href=https://github.com/unikraft/lib-newlib>newlib</a> and <a href=https://github.com/unikraft/lib-lwip>lwip</a>) in the <code>libs/</code> folder.</p><p>We clone the <a href=https://github.com/unikraft/app-redis/>app-redis</a> repository in the <code>apps/</code> folder.
In this directory, we need to create two files:</p><ul><li><code>Makefile</code>: it contains rules for building the application as well as specifying the libraries that the application needs</li><li><code>Makefile.uk</code>: used to define variables needed to compile the application or to add application-specific flags</li></ul><p>Also, in the <code>Makefile</code>, the order in which the libraries are mentioned in the <code>LIBS</code> variable is important to avoid the occurrence of compilation errors.</p><pre><code>UK_ROOT ?= $(PWD)/../../unikraft
UK_LIBS ?= $(PWD)/../../libs
LIBS := $(UK_LIBS)/lib-pthread-embedded:$(UK_LIBS)/lib-newlib:$(UK_LIBS)/lib-lwip:$(UK_LIBS)/lib-redis

all:
	@$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS)

$(MAKECMDGOALS):
	@$(MAKE) -C $(UK_ROOT) A=$(PWD) L=$(LIBS) $(MAKECMDGOALS)
</code></pre><h4 id=configure-1>Configure</h4><p>We configure the application by running:</p><pre><code>$ make menuconfig
</code></pre><p>We select the Redis library from the configuration menu, <code>Library Configuration</code> section.
For starters, we select the option to generate the main source file used to run the application.</p><p><img src=/docs/sessions/04-complex-applications/images/redis_menu.png alt="redis selection menu"></p><h4 id=build-1>Build</h4><p>We build the application by running:</p><pre><code>$ make
</code></pre><h4 id=test-1>Test</h4><p>To connect to the Redis server, the network features should be configured.
Hence, in the configuration menu in the <code>Library Configuration</code> section, within the <code>lwip library</code> the following options should be selected:</p><ul><li><code>IPv4</code></li><li><code>UDP support</code></li><li><code>TCP support</code></li><li><code>ICMP support</code></li><li><code>DHCP support</code></li><li><code>Socket API</code></li></ul><p><img src=/docs/sessions/04-complex-applications/images/lwip_redis_menu.png alt="lwip selection menu"></p><p>The Redis application needs a configuration file to start.
Thus, a filesystem should be selected in Unikraft.
The filesystem we used was 9PFS.
So, in the <code>Library Configuration</code> section of the configuration menu, the following selection chain should be made in the vfscore library: <code>VFSCore Interface</code> -> <code>vfscore Configuration</code> -> <code>Automatically mount a root filesystem</code> -> <code>Default root filesystem</code> -> <code>9PFS</code>.</p><p>Therefore, following the steps above, the build of the entire system, together with the Redis application will be successful.
We used a script to run the application in which a bridge and a network interface (<code>kraft0</code>) are created.
The network interface has an IP associated with it used by clients to connect to the Redis server.
Also, the script takes care of starting the Redis server, but also of stopping it, deleting the settings created for the network.</p><pre><code>brctl addbr kraft0
ifconfig kraft0 172.44.0.1
ifconfig kraft0 up

dnsmasq -d \
        --log-queries \
        --bind-dynamic \
        --interface=kraft0 \
        --listen-addr=172.44.0.1 \
        --dhcp-range=172.44.0.2,172.44.0.254,255.255.255.0,12h &amp;&gt; $WORKDIR/dnsmasq.log &amp;

./qemu-guest.sh -k ./build/redis_kvm-x86_64 \
                -a &quot;/redis.conf&quot; \
                -b kraft0 \
                -e ./redis_files
                -m 100
</code></pre><p>The Redis server start command has several parameters:</p><ul><li><code>k</code> indicates the executable resulting from the build of the entire system together with the <code>Redis</code> application</li><li><code>e</code> indicates the path to the shared directory where the Unikraft filesystem will be mounted</li><li><code>b</code> indicates the network interface used for external communication</li><li><code>m</code> indicates the memory allocated to the application</li><li><code>a</code> allows the addition of parameters specific to running the application</li></ul><p>The following image is presenting an overview of our setup:</p><p><img src=/docs/sessions/04-complex-applications/images/redis_setup.png alt="lwip selection menu"></p><p>Consequently, after running the script the Redis server will start and dnsmasq will dynamically assign an IP address.
The IP can be seen in the output of qemu as bellow:</p><p><img src=/docs/sessions/04-complex-applications/images/redis_ip.png alt="redis ip"></p><p>Using the received IP, it will be possible to connect clients to it using <code>redis-cli</code> (the binary <code>redis-cli</code> is the folder for this work item):</p><pre><code>$ ./redis-cli -h 172.88.0.76 -p 6379
172.88.0.2:6379&gt; PING
PONG
172.88.0.2:6379&gt;
</code></pre><h3 id=04-redis-static-ip-address>04. Redis Static IP Address</h3><p>In tutorial above we have dynamically assigned an IP to the network interface used by Unikraft using the <code>dnsmasq</code> utility.
Find the support files in the <code>work/04-obtain-the-ip-statically/</code> folder of the session directory.</p><p>Modify the launching script and run the application with a static IP.
Beware that the assigned IP address must differ from the one assigned on the bridge.</p><p>You can use <code>redis-cli</code>, found in the suport folder to test your changes.
If everything runs as expected you should see the following output:</p><pre><code>$ ./redis-cli -h 172.88.0.76 -p 6379
172.88.0.2:6379&gt; PING
PONG
172.88.0.2:6379&gt;
</code></pre><h3 id=05-redis-benchmarking-tutorial>05. Redis Benchmarking (Tutorial)</h3><p>We aim to do benchmarking for the Redis app running on top of Unikraft and for the Redis running on top of Linux.
Find the support files in the <code>work/05-benchmark-redis/</code> folder of the session directory.
There are three binaries: <code>redis-cli</code>, <code>redis-benchmark</code>, and <code>redis</code>.</p><p>First, we will start by benchmarking <code>redis app</code>, running on Unikraft.
Start the Redis on the top of Unikraft as we have already done at above and in another terminal run the following command:</p><pre><code>$ ./redis-benchmark --csv -q -r 100 -n 10000 -c 1 -h 172.44.0.76 -p 6379 -P 8 -t set,get
</code></pre><p>The description of the used option can be seen here:</p><pre><code>Usage: redis-benchmark [-h &lt;host&gt;] [-p &lt;port&gt;] [-c &lt;clients&gt;] [-n &lt;requests&gt;] [-k &lt;boolean&gt;]

 -h &lt;hostname&gt;      Server hostname (default 127.0.0.1)
 -p &lt;port&gt;          Server port (default 6379)
 -c &lt;clients&gt;       Number of parallel connections (default 50)
 -n &lt;requests&gt;      Total number of requests (default 100000)
 -P &lt;numreq&gt;        Pipeline &lt;numreq&gt; requests. Default 1 (no pipeline).
 -q                 Quiet. Just show query/sec values
 --csv              Output in CSV format
 -t &lt;tests&gt;         Only run the comma separated list of tests. The test
                    names are the same as the ones produced as output.
</code></pre><p>If everything runs as expected, you&rsquo;ll see the following output:</p><pre><code>&quot;SET&quot;,&quot;147058.81&quot;
&quot;GET&quot;,&quot;153846.16&quot;
</code></pre><p>The printed values represent <code>requests/second</code> for the operation <code>set</code> and <code>get</code>.</p><p>Further, we will run the executable <code>redis-server</code> (<code>./redis-server</code>), which can be found in the support folder, and the following command (only the IP address of the redis server was changed):</p><pre><code>$ ./redis-benchmark --csv -q -r 100 -n 10000 -c 1 -h 127.0.0.1 -p 6379 -P 8 -t set,get
</code></pre><p>After that you&rsquo;ll get something like this:</p><pre><code>&quot;SET&quot;,&quot;285714.28&quot;
&quot;GET&quot;,&quot;294117.62&quot;
</code></pre><h3 id=06-nginx>06. Nginx</h3><p>The aim of this work item is to set up and run Nginx.
Find the support files in the <code>work/06-set-up-and-run-nginx/</code> folder of the session directory.</p><p>From the point of view of the library dependencies, the nginx app has the same dependencies as the Redis app.
It&rsquo;s your choice how you assign the IP to the VM.</p><p>In the support folder of this work item there is a subfolder called <code>nginx</code> with the following structure:</p><pre><code>nginx_files
`-- nginx/
    |-- conf/
    |   |-- fastcgi.conf
    |   |-- fastcgi_params
    |   |-- koi-utf
    |   |-- koi-win
    |   |-- mime.types
    |   |-- nginx.conf
    |   |-- nginx.conf.default
    |   |-- scgi_params
    |   |-- uwsgi_params
    |   `-- win-utf
    |-- data/
    |   `-- images/
    |       `-- small-img100.png
    |-- html/
    |   |-- 50x.html
    |   `-- index.html
    `-- logs/
        |-- error.log
        `-- nginx.pid
</code></pre><p>The path to the <code>nginx_files</code> folder should be given as a parameter to the <code>-e option</code> of the <code>qemu-guest</code>.
The <code>html/</code> folder stores the files of the website you want to be run.</p><p>If everything works as expected, you should see the following web page in the browser.</p><p><img src=/docs/sessions/04-complex-applications/images/nginx_output.png alt="nginx output"></p><h3 id=07-nginx-benchmarking-tutorial>07. Nginx Benchmarking (Tutorial)</h3><p>Benchmarking Nginx running on the top of Unikraft can be achieved with a utility called <code>iperf</code>.
The package can be easily installed using the command:</p><pre><code>sudo apt-get install -y iperf
</code></pre><p>Next, we will start the nginx app as we have done at the previous work item and then we will open another two terminals.
We&rsquo;ll start an <code>iperf</code> server in the first terminal with the command:</p><pre><code>$ iperf -s
</code></pre><p>In the second terminal we&rsquo;ll start an <code>iperf</code> client with the command:</p><pre><code>$ iperf -c 172.44.0.76 -p 80
</code></pre><p>If everything runs as expected, then we will see the following output:</p><pre><code>------------------------------------------------------------
Client connecting to 172.44.0.76, TCP port 80
TCP window size: 85.0 KByte (default)
------------------------------------------------------------
[  3] local 172.44.0.1 port 33262 connected with 172.44.0.76 port 80
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0-10.0 sec  1.28 GBytes  1.10 Gbits/sec
</code></pre><h3 id=08-give-us-feedback>08. Give Us Feedback</h3><p>We want to know how to make the next sessions better. For this we need your <a href=https://forms.gle/QyvxBx19cK4fUYRS7>feedback</a>. Thank you!</p><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="feedback--answer feedback--answer-yes">Yes</button>
<button class="feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/unikraft/summer-of-code-2021/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/unikraft/summer-of-code-2021/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified August 27, 2021: <a href=https://github.com/unikraft/summer-of-code-2021/commit/4aa0f030ad595f755365279c7965c5b84a6204bb>05-contrib: Review session contents (4aa0f03)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel="noopener noreferrer" href=https://bit.ly/UnikraftDiscord><i class="fab fa-discord"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/UnikraftSDK><i class="fab fa-twitter"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/unikraft/unikraft><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel="noopener noreferrer" href=https://linkedin.com/company/unikraft-sdk><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 Unikraft and Open-Source Contributors. All Rights Reserved</small></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>